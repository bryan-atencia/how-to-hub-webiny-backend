{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _taggedTemplateLiteral from \"@babel/runtime/helpers/taggedTemplateLiteral\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\n\nfunction _templateObject13() {\n  var data = _taggedTemplateLiteral([\"Delete content model\"]);\n\n  _templateObject13 = function _templateObject13() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject12() {\n  var data = _taggedTemplateLiteral([\"Edit content model\"]);\n\n  _templateObject12 = function _templateObject12() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject11() {\n  var data = _taggedTemplateLiteral([\"View entries\"]);\n\n  _templateObject11 = function _templateObject11() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject10() {\n  var data = _taggedTemplateLiteral([\"View content\"]);\n\n  _templateObject10 = function _templateObject10() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject9() {\n  var data = _taggedTemplateLiteral([\"Last modified: {time}.\"]);\n\n  _templateObject9 = function _templateObject9() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject8() {\n  var data = _taggedTemplateLiteral([\"Created by: {user}.\"]);\n\n  _templateObject8 = function _templateObject8() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject7() {\n  var data = _taggedTemplateLiteral([\"Title Z-A\"]);\n\n  _templateObject7 = function _templateObject7() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject6() {\n  var data = _taggedTemplateLiteral([\"Title A-Z\"]);\n\n  _templateObject6 = function _templateObject6() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject5() {\n  var data = _taggedTemplateLiteral([\"Oldest to newest\"]);\n\n  _templateObject5 = function _templateObject5() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject4() {\n  var data = _taggedTemplateLiteral([\"Newest to oldest\"]);\n\n  _templateObject4 = function _templateObject4() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject3() {\n  var data = _taggedTemplateLiteral([\"Content Models\"]);\n\n  _templateObject3 = function _templateObject3() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"Something unexpected happened.\"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"Content model {name} deleted.\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport React, { useCallback, useRef } from \"react\";\nimport TimeAgo from \"timeago-react\";\nimport { useRouter } from \"@webiny/react-router\";\nimport { css } from \"emotion\";\nimport get from \"lodash/get\";\nimport { ConfirmationDialog } from \"@webiny/ui/ConfirmationDialog\";\nimport { DeleteIcon, EditIcon } from \"@webiny/ui/List/DataList/icons\";\nimport { ReactComponent as ViewListIcon } from \"@svgr/webpack!@webiny/app-headless-cms/admin/icons/view_list.svg\";\nimport { DELETE_CONTENT_MODEL } from \"../../viewsGraphql\";\nimport { useApolloClient } from \"@webiny/app-headless-cms/admin/hooks\";\nimport { useSnackbar } from \"@webiny/app-admin/hooks/useSnackbar\";\nimport CurrentEnvironmentLabel from \"./../../components/CurrentEnvironmentLabel\";\nimport { DataList, List, ListItem, ListItemText, ListItemTextSecondary, ListItemMeta, ListActions } from \"@webiny/ui/List\";\nimport { IconButton } from \"@webiny/ui/Button\";\nimport { Tooltip } from \"@webiny/ui/Tooltip\";\nimport { i18n } from \"@webiny/app/i18n\";\nvar t = i18n.namespace(\"FormsApp.ContentModelsDataList\");\nvar rightAlign = /*#__PURE__*/css({\n  alignItems: \"flex-end !important\",\n  justifyContent: \"center !important\"\n}, \"label:rightAlign;\");\nvar listItemMinHeight = /*#__PURE__*/css({\n  minHeight: \"66px !important\"\n}, \"label:listItemMinHeight;\");\nvar viewEntriesIconStyles = /*#__PURE__*/css({\n  color: \"var(--mdc-theme-text-secondary-on-background)\"\n}, \"label:viewEntriesIconStyles;\");\n\nvar ContentModelsDataList = function ContentModelsDataList(props) {\n  var dataList = props.dataList;\n\n  var _useRouter = useRouter(),\n      location = _useRouter.location,\n      history = _useRouter.history;\n\n  var client = useApolloClient();\n\n  var _useSnackbar = useSnackbar(),\n      showSnackbar = _useSnackbar.showSnackbar;\n\n  var deleteRecord = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(item) {\n      var res, _get, data, error, query;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return client.mutate({\n                mutation: DELETE_CONTENT_MODEL,\n                variables: {\n                  id: item.id\n                },\n                awaitRefetchQueries: true,\n                refetchQueries: [\"HeadlessCmsListContentModels\", \"HeadlessCmsListMenuContentGroupsModels\"]\n              });\n\n            case 2:\n              res = _context.sent;\n              _get = get(res, \"data.deleteContentModel\"), data = _get.data, error = _get.error;\n\n              if (data) {\n                showSnackbar(t(_templateObject())({\n                  name: item.name\n                }));\n              } else {\n                showSnackbar(error.message, {\n                  title: t(_templateObject2())\n                });\n              }\n\n              if (item.id === props.id) {\n                query = new URLSearchParams(location.search);\n                query.delete(\"id\");\n                history.push({\n                  search: query.toString()\n                });\n              }\n\n              dataList.refresh();\n\n            case 7:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function deleteRecord(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var editHandlers = useRef({});\n  var editRecord = useCallback(function (contentModel) {\n    if (!editHandlers.current[contentModel.id]) {\n      editHandlers.current[contentModel.id] = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                history.push(\"/cms/content-models/\" + contentModel.id);\n\n              case 1:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n    }\n\n    return editHandlers.current[contentModel.id];\n  }, undefined);\n  var viewContentEntries = useCallback(function (contentModel) {\n    return function () {\n      return history.push(\"/cms/content-models/manage/\" + contentModel.modelId);\n    };\n  }, undefined);\n  return /*#__PURE__*/React.createElement(DataList, Object.assign({}, dataList, {\n    title: t(_templateObject3()),\n    actions: /*#__PURE__*/React.createElement(CurrentEnvironmentLabel, {\n      style: {\n        justifyContent: \"flex-end\"\n      }\n    }),\n    sorters: [{\n      label: t(_templateObject4()),\n      sorters: {\n        createdOn: -1\n      }\n    }, {\n      label: t(_templateObject5()),\n      sorters: {\n        createdOn: 1\n      }\n    }, {\n      label: t(_templateObject6()),\n      sorters: {\n        name: 1\n      }\n    }, {\n      label: t(_templateObject7()),\n      sorters: {\n        name: -1\n      }\n    }]\n  }), function (_ref3) {\n    var _ref3$data = _ref3.data,\n        data = _ref3$data === void 0 ? [] : _ref3$data;\n    return /*#__PURE__*/React.createElement(List, {\n      \"data-testid\": \"default-data-list\"\n    }, data.map(function (contentModel) {\n      return /*#__PURE__*/React.createElement(ListItem, {\n        key: contentModel.id,\n        className: listItemMinHeight\n      }, /*#__PURE__*/React.createElement(ListItemText, null, contentModel.name, contentModel.createdBy && /*#__PURE__*/React.createElement(ListItemTextSecondary, null, contentModel.createdBy.firstName && /*#__PURE__*/React.createElement(React.Fragment, null, t(_templateObject8())({\n        user: contentModel.createdBy.firstName\n      }), \" \"), t(_templateObject9())({\n        time: /*#__PURE__*/React.createElement(TimeAgo, {\n          datetime: contentModel.savedOn\n        })\n      }))), /*#__PURE__*/React.createElement(ListItemMeta, {\n        className: rightAlign\n      }, /*#__PURE__*/React.createElement(ListActions, null, /*#__PURE__*/React.createElement(Tooltip, {\n        content: t(_templateObject10()),\n        placement: \"top\"\n      }, /*#__PURE__*/React.createElement(IconButton, {\n        icon: /*#__PURE__*/React.createElement(ViewListIcon, {\n          className: viewEntriesIconStyles\n        }),\n        label: t(_templateObject11()),\n        onClick: viewContentEntries(contentModel)\n      })), /*#__PURE__*/React.createElement(Tooltip, {\n        content: t(_templateObject12()),\n        placement: \"top\"\n      }, /*#__PURE__*/React.createElement(EditIcon, {\n        onClick: editRecord(contentModel)\n      })), /*#__PURE__*/React.createElement(ConfirmationDialog, null, function (_ref4) {\n        var showConfirmation = _ref4.showConfirmation;\n        return /*#__PURE__*/React.createElement(Tooltip, {\n          content: t(_templateObject13()),\n          placement: \"top\"\n        }, /*#__PURE__*/React.createElement(DeleteIcon, {\n          onClick: function onClick() {\n            return showConfirmation( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n              return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n                while (1) {\n                  switch (_context3.prev = _context3.next) {\n                    case 0:\n                      return _context3.abrupt(\"return\", deleteRecord(contentModel));\n\n                    case 1:\n                    case \"end\":\n                      return _context3.stop();\n                  }\n                }\n              }, _callee3);\n            })));\n          }\n        }));\n      }))));\n    }));\n  });\n};\n\nexport default ContentModelsDataList;","map":null,"metadata":{},"sourceType":"module"}