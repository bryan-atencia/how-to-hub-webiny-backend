{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _taggedTemplateLiteral from \"@babel/runtime/helpers/taggedTemplateLiteral\";\n\nfunction _templateObject5() {\n  var data = _taggedTemplateLiteral([\"Headless CMS\"]);\n\n  _templateObject5 = function _templateObject5() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject4() {\n  var data = _taggedTemplateLiteral([\"Something went wrong\"]);\n\n  _templateObject4 = function _templateObject4() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject3() {\n  var data = _taggedTemplateLiteral([\"Installing CMS...\"]);\n\n  _templateObject3 = function _templateObject3() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"\\n    mutation InstallCms {\\n        cms {\\n            install {\\n                data\\n                error {\\n                    code\\n                    message\\n                }\\n            }\\n        }\\n    }\\n\"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n    {\\n        cms {\\n            isInstalled {\\n                data\\n                error {\\n                    code\\n                    message\\n                }\\n            }\\n        }\\n    }\\n\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport React, { useState, useEffect } from \"react\";\nimport gql from \"graphql-tag\";\nimport { useApolloClient } from \"react-apollo\";\nimport { i18n } from \"@webiny/app/i18n\";\nimport { Alert } from \"@webiny/ui/Alert\";\nimport { CircularProgress } from \"@webiny/ui/Progress\";\nimport { SimpleForm, SimpleFormContent } from \"@webiny/app-admin/components/SimpleForm\";\nimport styled from \"@emotion/styled\";\nvar SimpleFormPlaceholder = /*#__PURE__*/styled(\"div\", {\n  target: \"e1pjb6uy0\",\n  label: \"SimpleFormPlaceholder\"\n})({\n  minHeight: 300,\n  minWidth: 400\n});\nvar t = i18n.ns(\"app-headless-cms/admin/installation\");\nvar IS_INSTALLED = gql(_templateObject());\nvar INSTALL = gql(_templateObject2());\n\nvar CMSInstaller = function CMSInstaller(_ref) {\n  var onInstalled = _ref.onInstalled;\n  var client = useApolloClient();\n\n  var _useState = useState(null),\n      _useState2 = _slicedToArray(_useState, 2),\n      error = _useState2[0],\n      setError = _useState2[1];\n\n  useEffect(function () {\n    client.mutate({\n      mutation: INSTALL\n    }).then(function (_ref2) {\n      var data = _ref2.data;\n      var error = data.cms.install.error;\n\n      if (error) {\n        setError(error.message);\n        return;\n      } // Just so the user sees the actual message.\n\n\n      setTimeout(onInstalled, 3000);\n    });\n  }, []);\n  return /*#__PURE__*/React.createElement(SimpleForm, null, /*#__PURE__*/React.createElement(CircularProgress, {\n    label: t(_templateObject3())\n  }), error && /*#__PURE__*/React.createElement(Alert, {\n    title: t(_templateObject4()),\n    type: \"danger\"\n  }, error), /*#__PURE__*/React.createElement(SimpleFormContent, null, /*#__PURE__*/React.createElement(SimpleFormPlaceholder, null)));\n};\n\nvar plugin = {\n  name: \"admin-installation-cms\",\n  type: \"admin-installation\",\n  title: t(_templateObject5()),\n  dependencies: [],\n  secure: true,\n  isInstalled: function isInstalled(_ref3) {\n    return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var client, _yield$client$query, data;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              client = _ref3.client;\n              _context.next = 3;\n              return client.query({\n                query: IS_INSTALLED\n              });\n\n            case 3:\n              _yield$client$query = _context.sent;\n              data = _yield$client$query.data;\n              return _context.abrupt(\"return\", data.cms.isInstalled.data);\n\n            case 6:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }))();\n  },\n  render: function render(_ref4) {\n    var onInstalled = _ref4.onInstalled;\n    return /*#__PURE__*/React.createElement(CMSInstaller, {\n      onInstalled: onInstalled\n    });\n  }\n};\nexport default plugin;","map":null,"metadata":{},"sourceType":"module"}