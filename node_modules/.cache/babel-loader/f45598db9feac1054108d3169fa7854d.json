{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _taggedTemplateLiteral from \"@babel/runtime/helpers/taggedTemplateLiteral\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _upperFirst from \"lodash/upperFirst\";\nimport _get from \"lodash/get\";\n\nfunction _templateObject9() {\n  var data = _taggedTemplateLiteral([\"Last modified: {time}.\"]);\n\n  _templateObject9 = function _templateObject9() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject8() {\n  var data = _taggedTemplateLiteral([\"Created by: {user}.\"]);\n\n  _templateObject8 = function _templateObject8() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject7() {\n  var data = _taggedTemplateLiteral([\"Name Z-A\"]);\n\n  _templateObject7 = function _templateObject7() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject6() {\n  var data = _taggedTemplateLiteral([\"Name A-Z\"]);\n\n  _templateObject6 = function _templateObject6() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject5() {\n  var data = _taggedTemplateLiteral([\"Oldest to newest\"]);\n\n  _templateObject5 = function _templateObject5() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject4() {\n  var data = _taggedTemplateLiteral([\"Newest to oldest\"]);\n\n  _templateObject4 = function _templateObject4() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject3() {\n  var data = _taggedTemplateLiteral([\"Forms\"]);\n\n  _templateObject3 = function _templateObject3() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"Something unexpected happened.\"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"Form {name} deleted.\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport React, { useRef, useCallback } from \"react\";\nimport TimeAgo from \"timeago-react\";\nimport { useRouter } from \"@webiny/react-router\";\nimport { css } from \"emotion\";\nimport { Typography } from \"@webiny/ui/Typography\";\nimport { ConfirmationDialog } from \"@webiny/ui/ConfirmationDialog\";\nimport { DeleteIcon, EditIcon } from \"@webiny/ui/List/DataList/icons\";\nimport { DELETE_FORM, CREATE_REVISION_FROM } from \"@webiny/app-form-builder/admin/viewsGraphql\";\nimport { useApolloClient } from \"react-apollo\";\nimport { useHandler } from \"@webiny/app/hooks/useHandler\";\nimport { useSnackbar } from \"@webiny/app-admin/hooks/useSnackbar\";\nimport { DataList, List, ListItem, ListItemText, ListItemTextSecondary, ListItemMeta, ListActions } from \"@webiny/ui/List\";\nimport { i18n } from \"@webiny/app/i18n\";\nvar t = i18n.namespace(\"FormsApp.FormsDataList\");\nvar rightAlign = /*#__PURE__*/css({\n  alignItems: \"flex-end !important\"\n}, \"label:rightAlign;\");\nvar listItemMinHeight = /*#__PURE__*/css({\n  minHeight: \"66px !important\"\n}, \"label:listItemMinHeight;\");\n\nvar FormsDataList = function FormsDataList(props) {\n  var editHandlers = useRef({});\n  var dataList = props.dataList;\n\n  var _useRouter = useRouter(),\n      location = _useRouter.location,\n      history = _useRouter.history;\n\n  var client = useApolloClient();\n\n  var _useSnackbar = useSnackbar(),\n      showSnackbar = _useSnackbar.showSnackbar;\n\n  var deleteRecord = useHandler(props, function (_ref) {\n    var id = _ref.id;\n    return /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(item) {\n        var res, _get2, data, error, _query;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return client.mutate({\n                  mutation: DELETE_FORM,\n                  variables: {\n                    id: item.id\n                  }\n                });\n\n              case 2:\n                res = _context.sent;\n                _get2 = _get(res, \"data.forms.deleteForm\"), data = _get2.data, error = _get2.error;\n\n                if (data) {\n                  showSnackbar(t(_templateObject())({\n                    name: item.name\n                  }));\n                } else {\n                  showSnackbar(error.message, {\n                    title: t(_templateObject2())\n                  });\n                }\n\n                if (item.id === id) {\n                  _query = new URLSearchParams(location.search);\n\n                  _query.delete(\"id\");\n\n                  history.push({\n                    search: _query.toString()\n                  });\n                }\n\n                dataList.refresh();\n\n              case 7:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function (_x) {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n  });\n  var editRecord = useCallback(function (form) {\n    if (!editHandlers.current[form.id]) {\n      editHandlers.current[form.id] = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n        var _yield$client$mutate, res, _res$forms$revision, data, error;\n\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                if (!form.published) {\n                  _context2.next = 11;\n                  break;\n                }\n\n                _context2.next = 3;\n                return client.mutate({\n                  mutation: CREATE_REVISION_FROM,\n                  variables: {\n                    revision: form.id\n                  },\n                  refetchQueries: [\"FormsListForms\"]\n                });\n\n              case 3:\n                _yield$client$mutate = _context2.sent;\n                res = _yield$client$mutate.data;\n                _res$forms$revision = res.forms.revision, data = _res$forms$revision.data, error = _res$forms$revision.error;\n\n                if (!error) {\n                  _context2.next = 8;\n                  break;\n                }\n\n                return _context2.abrupt(\"return\", showSnackbar(error.message));\n\n              case 8:\n                history.push(\"/forms/\".concat(data.id));\n                _context2.next = 12;\n                break;\n\n              case 11:\n                history.push(\"/forms/\" + form.id);\n\n              case 12:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n    }\n\n    return editHandlers.current[form.id];\n  }, []);\n  var query = new URLSearchParams(location.search);\n  return /*#__PURE__*/React.createElement(DataList, Object.assign({}, dataList, {\n    title: t(_templateObject3()),\n    sorters: [{\n      label: t(_templateObject4()),\n      sorters: {\n        createdOn: -1\n      }\n    }, {\n      label: t(_templateObject5()),\n      sorters: {\n        createdOn: 1\n      }\n    }, {\n      label: t(_templateObject6()),\n      sorters: {\n        name: 1\n      }\n    }, {\n      label: t(_templateObject7()),\n      sorters: {\n        name: -1\n      }\n    }]\n  }), function (_ref4) {\n    var _ref4$data = _ref4.data,\n        data = _ref4$data === void 0 ? [] : _ref4$data;\n    return /*#__PURE__*/React.createElement(List, {\n      \"data-testid\": \"default-data-list\"\n    }, data.map(function (form) {\n      return /*#__PURE__*/React.createElement(ListItem, {\n        key: form.id,\n        className: listItemMinHeight\n      }, /*#__PURE__*/React.createElement(ListItemText, {\n        onClick: function onClick() {\n          query.set(\"id\", form.id);\n          history.push({\n            search: query.toString()\n          });\n        }\n      }, form.name, form.createdBy && /*#__PURE__*/React.createElement(ListItemTextSecondary, null, form.createdBy.firstName && /*#__PURE__*/React.createElement(React.Fragment, null, t(_templateObject8())({\n        user: form.createdBy.firstName\n      }), \" \"), t(_templateObject9())({\n        time: /*#__PURE__*/React.createElement(TimeAgo, {\n          datetime: form.savedOn\n        })\n      }))), /*#__PURE__*/React.createElement(ListItemMeta, {\n        className: rightAlign\n      }, /*#__PURE__*/React.createElement(Typography, {\n        use: \"subtitle2\"\n      }, _upperFirst(form.status), \" (v\", form.version, \")\"), /*#__PURE__*/React.createElement(ListActions, null, /*#__PURE__*/React.createElement(EditIcon, {\n        onClick: editRecord(form)\n      }), /*#__PURE__*/React.createElement(ConfirmationDialog, null, function (_ref5) {\n        var showConfirmation = _ref5.showConfirmation;\n        return /*#__PURE__*/React.createElement(DeleteIcon, {\n          onClick: function onClick() {\n            return showConfirmation( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n              return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n                while (1) {\n                  switch (_context3.prev = _context3.next) {\n                    case 0:\n                      return _context3.abrupt(\"return\", deleteRecord(form));\n\n                    case 1:\n                    case \"end\":\n                      return _context3.stop();\n                  }\n                }\n              }, _callee3);\n            })));\n          }\n        });\n      }))));\n    }));\n  });\n};\n\nexport default FormsDataList;","map":null,"metadata":{},"sourceType":"module"}