{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _taggedTemplateLiteral from \"@babel/runtime/helpers/taggedTemplateLiteral\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\n\nfunction _templateObject5() {\n  var data = _taggedTemplateLiteral([\"No revisions to show.\"]);\n\n  _templateObject5 = function _templateObject5() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject4() {\n  var data = _taggedTemplateLiteral([\"Successfully published revision {revision}.\"]);\n\n  _templateObject4 = function _templateObject4() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject3() {\n  var data = _taggedTemplateLiteral([\"Content entry revision deleted.\"]);\n\n  _templateObject3 = function _templateObject3() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"Content entry and all of its revisions deleted.\"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"New content entry revision created.\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport React, { useCallback, useMemo } from \"react\";\nimport { css } from \"emotion\";\nimport { List } from \"@webiny/ui/List\";\nimport { Elevation } from \"@webiny/ui/Elevation\";\nimport Revision from \"./Revision\";\nimport get from \"lodash/get\";\nimport { CircularProgress } from \"@webiny/ui/Progress\";\nimport { useMutation } from \"@webiny/app-headless-cms/admin/hooks\";\nimport { createCreateFromMutation, createDeleteMutation, createPublishMutation } from \"@webiny/app-headless-cms/admin/components/ContentModelForm/graphql\";\nimport { useSnackbar } from \"@webiny/app-admin/hooks/useSnackbar\";\nimport { useRouter } from \"@webiny/react-router\";\nimport { i18n } from \"@webiny/app/i18n\";\nvar t = i18n.ns(\"app-headless-cms/admin/plugins/content-details/content-revisions\");\nvar style = {\n  list: /*#__PURE__*/css({\n    position: \"relative\",\n    margin: 25,\n    display: \"flex\",\n    flexDirection: \"column\",\n    overflow: \"scroll\",\n    maxHeight: \"calc(100vh - 160px)\",\n    \".mdc-list .mdc-list-item\": {\n      borderBottom: \"1px solid var(--mdc-theme-on-background)\"\n    },\n    \".mdc-list .mdc-list-item:last-child\": {\n      borderBottom: \"none\"\n    }\n  }, \"label:list;\"),\n  nothingToShow: /*#__PURE__*/css({\n    padding: 20,\n    margin: 25,\n    textAlign: \"center\"\n  }, \"label:nothingToShow;\")\n};\n\nvar RevisionsList = function RevisionsList(props) {\n  var _useSnackbar = useSnackbar(),\n      showSnackbar = _useSnackbar.showSnackbar;\n\n  var content = props.content,\n      contentModel = props.contentModel,\n      setLoading = props.setLoading,\n      dataList = props.dataList,\n      revisionsList = props.revisionsList;\n\n  var _useRouter = useRouter(),\n      history = _useRouter.history;\n\n  var _useMemo = useMemo(function () {\n    return {\n      CREATE_CONTENT_FROM: createCreateFromMutation(contentModel),\n      DELETE_CONTENT: createDeleteMutation(contentModel),\n      PUBLISH_CONTENT: createPublishMutation(contentModel)\n    };\n  }, [contentModel.modelId]),\n      CREATE_CONTENT_FROM = _useMemo.CREATE_CONTENT_FROM,\n      DELETE_CONTENT = _useMemo.DELETE_CONTENT,\n      PUBLISH_CONTENT = _useMemo.PUBLISH_CONTENT;\n\n  var revisions = get(revisionsList, \"data.content.data.meta.revisions\", []);\n\n  var _useMutation = useMutation(CREATE_CONTENT_FROM),\n      _useMutation2 = _slicedToArray(_useMutation, 1),\n      createFromMutation = _useMutation2[0];\n\n  var _useMutation3 = useMutation(DELETE_CONTENT),\n      _useMutation4 = _slicedToArray(_useMutation3, 1),\n      deleteMutation = _useMutation4[0];\n\n  var _useMutation5 = useMutation(PUBLISH_CONTENT),\n      _useMutation6 = _slicedToArray(_useMutation5, 1),\n      publishMutation = _useMutation6[0];\n\n  var createContentFrom = useCallback( /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(revision) {\n      var response, id, query;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              setLoading(true);\n              _context.next = 3;\n              return createFromMutation({\n                variables: {\n                  revision: revision.id\n                }\n              });\n\n            case 3:\n              response = _context.sent;\n\n              if (!response.data.content.error) {\n                _context.next = 8;\n                break;\n              }\n\n              setLoading(false);\n              showSnackbar(response.data.content.error.message);\n              return _context.abrupt(\"return\");\n\n            case 8:\n              _context.next = 10;\n              return Promise.all([dataList.refresh(), revisionsList.refetch()]);\n\n            case 10:\n              setLoading(false);\n              showSnackbar(t(_templateObject()));\n              id = response.data.content.data.id;\n              query = new URLSearchParams(location.search);\n              query.set(\"id\", id);\n              history.push({\n                search: query.toString()\n              });\n\n            case 16:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function (_x) {\n      return _ref.apply(this, arguments);\n    };\n  }(), []);\n  var deleteContent = useCallback( /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(revision) {\n      var response, revisionId, i, current, query;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              setLoading(true);\n              _context2.next = 3;\n              return deleteMutation({\n                variables: {\n                  revision: revision.id\n                }\n              });\n\n            case 3:\n              response = _context2.sent;\n\n              if (!response.data.content.error) {\n                _context2.next = 8;\n                break;\n              }\n\n              setLoading(false);\n              showSnackbar(response.data.content.error.message);\n              return _context2.abrupt(\"return\");\n\n            case 8:\n              if (!(revision.id === revision.meta.parent)) {\n                _context2.next = 15;\n                break;\n              }\n\n              _context2.next = 11;\n              return dataList.refresh();\n\n            case 11:\n              setLoading(false);\n              history.push(\"/cms/content-models/manage/\".concat(contentModel.modelId));\n              showSnackbar(t(_templateObject2()));\n              return _context2.abrupt(\"return\");\n\n            case 15:\n              _context2.next = 17;\n              return Promise.all([dataList.refresh(), revisionsList.refetch()]);\n\n            case 17:\n              setLoading(false);\n\n              if (!(revision.id === content.id)) {\n                _context2.next = 29;\n                break;\n              }\n\n              i = 0;\n\n            case 20:\n              if (!(i < content.revisions.length)) {\n                _context2.next = 28;\n                break;\n              }\n\n              current = content.revisions[i];\n\n              if (!(current.id !== content.id)) {\n                _context2.next = 25;\n                break;\n              }\n\n              revisionId = current.id;\n              return _context2.abrupt(\"break\", 28);\n\n            case 25:\n              i++;\n              _context2.next = 20;\n              break;\n\n            case 28:\n              if (revisionId) {\n                query = new URLSearchParams(location.search);\n                query.set(\"id\", revisionId);\n                history.push({\n                  search: query.toString()\n                });\n              }\n\n            case 29:\n              showSnackbar(t(_templateObject3()));\n\n            case 30:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function (_x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }(), []);\n  var publishContent = useCallback( /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(revision) {\n      var response, content;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              setLoading(true);\n              _context3.next = 3;\n              return publishMutation({\n                variables: {\n                  revision: revision.id\n                }\n              });\n\n            case 3:\n              response = _context3.sent;\n              content = get(response, \"data.content\");\n\n              if (!content.error) {\n                _context3.next = 9;\n                break;\n              }\n\n              setLoading(false);\n              showSnackbar(content.error.message);\n              return _context3.abrupt(\"return\");\n\n            case 9:\n              _context3.next = 11;\n              return dataList.refresh();\n\n            case 11:\n              setLoading(false);\n              showSnackbar( /*#__PURE__*/React.createElement(\"span\", null, t(_templateObject4())({\n                revision: /*#__PURE__*/React.createElement(\"strong\", null, \"#\", revision.meta.version)\n              })));\n\n            case 13:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    return function (_x3) {\n      return _ref3.apply(this, arguments);\n    };\n  }(), []);\n  return /*#__PURE__*/React.createElement(Elevation, {\n    className: style.list,\n    z: 2\n  }, props.getLoading() && /*#__PURE__*/React.createElement(CircularProgress, null), content.id && revisions.length ? /*#__PURE__*/React.createElement(List, {\n    nonInteractive: true,\n    twoLine: true\n  }, revisions.map(function (revisions) {\n    return /*#__PURE__*/React.createElement(Revision, Object.assign({}, props, {\n      revision: revisions,\n      key: revisions.id,\n      createContentFrom: createContentFrom,\n      deleteContent: deleteContent,\n      publishContent: publishContent\n    }));\n  })) : /*#__PURE__*/React.createElement(\"div\", {\n    className: style.nothingToShow\n  }, t(_templateObject5())));\n};\n\nexport default RevisionsList;","map":null,"metadata":{},"sourceType":"module"}