{"ast":null,"code":"import _objectSpread from \"@babel/runtime/helpers/objectSpread2\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _taggedTemplateLiteral from \"@babel/runtime/helpers/taggedTemplateLiteral\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\n\nfunction _templateObject9() {\n  var data = _taggedTemplateLiteral([\"Are you sure you want to delete this token?\"]);\n\n  _templateObject9 = function _templateObject9() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject8() {\n  var data = _taggedTemplateLiteral([\"Delete Token\"]);\n\n  _templateObject8 = function _templateObject8() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject7() {\n  var data = _taggedTemplateLiteral([\"OK\"]);\n\n  _templateObject7 = function _templateObject7() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject6() {\n  var data = _taggedTemplateLiteral([\"Token name\"]);\n\n  _templateObject6 = function _templateObject6() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject5() {\n  var data = _taggedTemplateLiteral([\"Update Token\"]);\n\n  _templateObject5 = function _templateObject5() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject4() {\n  var data = _taggedTemplateLiteral([\"Token updated successfully!\"]);\n\n  _templateObject4 = function _templateObject4() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject3() {\n  var data = _taggedTemplateLiteral([\"Close\"]);\n\n  _templateObject3 = function _templateObject3() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"Token deleted successfully!\"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"Close\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport React, { useState } from \"react\";\nimport { useSnackbar } from \"@webiny/app-admin/hooks/useSnackbar\";\nimport { useApolloClient } from \"react-apollo\";\nimport { DELETE_PAT, UPDATE_PAT } from \"@webiny/app-security/admin/views/AccountGraphql\";\nimport { Dialog, DialogAccept, DialogActions, DialogCancel, DialogContent, DialogTitle } from \"@webiny/ui/Dialog\";\nimport { Input } from \"@webiny/ui/Input\";\nimport { ListItemMeta, SimpleListItem } from \"@webiny/ui/List\";\nimport { IconButton } from \"@webiny/ui/Button\";\nimport { ReactComponent as EditIcon } from \"@svgr/webpack!@webiny/app-security/admin/assets/icons/edit-24px.svg\";\nimport { ConfirmationDialog } from \"@webiny/ui/ConfirmationDialog\";\nimport { ReactComponent as DeleteIcon } from \"@svgr/webpack!@webiny/app-security/admin/assets/icons/delete-24px.svg\";\nimport { i18n } from \"@webiny/app/i18n\";\nvar t = i18n.ns(\"app-security/admin/roles/data-list\");\n\nvar TokenListItem = function TokenListItem(_ref) {\n  var setFormIsLoading = _ref.setFormIsLoading,\n      data = _ref.data,\n      setValue = _ref.setValue,\n      PAT = _ref.PAT;\n\n  var _useState = useState(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      showEditDialog = _useState2[0],\n      setShowEditDialog = _useState2[1];\n\n  var _useState3 = useState(PAT.name),\n      _useState4 = _slicedToArray(_useState3, 2),\n      tokenName = _useState4[0],\n      setTokenName = _useState4[1];\n\n  var _useSnackbar = useSnackbar(),\n      showSnackbar = _useSnackbar.showSnackbar;\n\n  var client = useApolloClient();\n\n  var deleteToken = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var queryResponse, error, newPATs;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              setFormIsLoading(true);\n              _context.next = 3;\n              return client.mutate({\n                mutation: DELETE_PAT,\n                variables: {\n                  id: PAT.id\n                }\n              });\n\n            case 3:\n              queryResponse = _context.sent;\n              setFormIsLoading(false);\n              error = queryResponse.data.security.deletePAT.error;\n\n              if (!error) {\n                _context.next = 8;\n                break;\n              }\n\n              return _context.abrupt(\"return\", showSnackbar(error.message, {\n                action: t(_templateObject())\n              }));\n\n            case 8:\n              newPATs = data.personalAccessTokens.filter(function (crtPAT) {\n                return crtPAT.id != PAT.id;\n              });\n              setValue(\"personalAccessTokens\", newPATs);\n              showSnackbar(t(_templateObject2()));\n\n            case 11:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function deleteToken() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var updateToken = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var queryResponse, error, newPATs;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              setFormIsLoading(true);\n              _context2.next = 3;\n              return client.mutate({\n                mutation: UPDATE_PAT,\n                variables: {\n                  id: PAT.id,\n                  data: {\n                    name: tokenName\n                  }\n                }\n              });\n\n            case 3:\n              queryResponse = _context2.sent;\n              setFormIsLoading(false);\n              error = queryResponse.data.security.updatePAT.error;\n\n              if (!error) {\n                _context2.next = 8;\n                break;\n              }\n\n              return _context2.abrupt(\"return\", showSnackbar(error.message, {\n                action: t(_templateObject3())\n              }));\n\n            case 8:\n              newPATs = data.personalAccessTokens.map(function (crtPAT) {\n                return crtPAT !== PAT ? crtPAT : _objectSpread(_objectSpread({}, crtPAT), {}, {\n                  name: tokenName\n                });\n              });\n              setValue(\"personalAccessTokens\", newPATs);\n              showSnackbar(t(_templateObject4()));\n\n            case 11:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function updateToken() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Dialog, {\n    open: showEditDialog,\n    onClose: function onClose() {\n      return setShowEditDialog(false);\n    },\n    \"data-testid\": \"update-personal-account-token-dialog\"\n  }, /*#__PURE__*/React.createElement(DialogTitle, null, t(_templateObject5())), /*#__PURE__*/React.createElement(DialogContent, null, /*#__PURE__*/React.createElement(Input, {\n    label: t(_templateObject6()),\n    value: tokenName,\n    onChange: function onChange(newName) {\n      return setTokenName(newName.slice(0, 100));\n    }\n  })), /*#__PURE__*/React.createElement(DialogActions, null, /*#__PURE__*/React.createElement(DialogCancel, null, \"Cancel\"), /*#__PURE__*/React.createElement(DialogAccept, {\n    \"data-testid\": \"AcceptUpdateToken-\".concat(PAT.id),\n    onClick: function onClick() {\n      return updateToken();\n    }\n  }, t(_templateObject7())))), /*#__PURE__*/React.createElement(SimpleListItem, {\n    \"data-testid\": \"pat-tokens-list-item\",\n    key: PAT.id,\n    text: /*#__PURE__*/React.createElement(\"div\", {\n      style: {\n        paddingLeft: \"16px\"\n      }\n    }, PAT.name)\n  }, /*#__PURE__*/React.createElement(ListItemMeta, null, /*#__PURE__*/React.createElement(IconButton, {\n    \"data-testid\": \"update-personal-access-token\",\n    onClick: function onClick() {\n      return setShowEditDialog(true);\n    },\n    icon: /*#__PURE__*/React.createElement(EditIcon, null)\n  }), /*#__PURE__*/React.createElement(ConfirmationDialog, {\n    \"data-testid\": \"delete-personal-access-token-dialog\",\n    title: t(_templateObject8()),\n    message: t(_templateObject9())\n  }, function (_ref4) {\n    var showConfirmation = _ref4.showConfirmation;\n    return /*#__PURE__*/React.createElement(IconButton, {\n      \"data-testid\": \"delete-personal-access-token\",\n      onClick: function onClick() {\n        return showConfirmation(function () {\n          return deleteToken();\n        });\n      },\n      icon: /*#__PURE__*/React.createElement(DeleteIcon, null)\n    });\n  }))));\n};\n\nexport default TokenListItem;","map":null,"metadata":{},"sourceType":"module"}