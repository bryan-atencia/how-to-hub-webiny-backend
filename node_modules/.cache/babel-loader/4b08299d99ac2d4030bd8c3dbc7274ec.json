{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _createSuper from \"@babel/runtime/helpers/createSuper\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport * as React from \"react\";\nimport * as toolbar from \"./toolbar\";\nimport styled from \"@emotion/styled\";\nimport classNames from \"classnames\";\nimport { ButtonSecondary, ButtonPrimary } from \"@webiny/ui/Button\";\nimport loadScript from \"load-script\";\nvar Toolbar = /*#__PURE__*/styled(\"div\", {\n  target: \"eq22gs70\",\n  label: \"Toolbar\"\n})({\n  display: \"flex\",\n  justifyContent: \"center\",\n  alignItems: \"center\",\n  backgroundColor: \"var(--mdc-theme-secondary)\",\n  margin: \"-24px -24px 0px -24px\",\n  padding: 2,\n  position: \"absolute\",\n  width: \"100%\",\n  boxSizing: \"border-box\",\n  zIndex: 10,\n  \"> div.disabled\": {\n    opacity: 0.5,\n    pointerEvents: \"none\"\n  }\n});\nvar ToolOptions = /*#__PURE__*/styled(\"div\", {\n  target: \"eq22gs71\",\n  label: \"ToolOptions\"\n})({\n  margin: \"50px -24px 10px -24px\",\n  boxSizing: \"border-box\",\n  padding: 10,\n  backgroundColor: \"var(--mdc-theme-background)\",\n  borderTop: \"1px solid var(--mdc-theme-on-background)\"\n});\nvar ApplyCancelActions = /*#__PURE__*/styled(\"div\", {\n  target: \"eq22gs72\",\n  label: \"ApplyCancelActions\"\n})({\n  textAlign: \"center\"\n});\n\nvar initScripts = function initScripts() {\n  return new Promise(function (resolve) {\n    // @ts-ignore\n    if (window.Caman) {\n      return resolve();\n    }\n\n    return loadScript(\"https://cdnjs.cloudflare.com/ajax/libs/camanjs/4.1.2/caman.full.min.js\", resolve);\n  });\n};\n\nvar ImageEditor = /*#__PURE__*/function (_React$Component) {\n  _inherits(ImageEditor, _React$Component);\n\n  var _super = _createSuper(ImageEditor);\n\n  function ImageEditor() {\n    var _this;\n\n    _classCallCheck(this, ImageEditor);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      tool: null,\n      src: \"\"\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"canvas\", /*#__PURE__*/React.createRef());\n\n    _defineProperty(_assertThisInitialized(_this), \"image\", null);\n\n    _defineProperty(_assertThisInitialized(_this), \"updateCanvas\", function () {\n      var src = _this.props.src;\n      _this.image = new window.Image();\n      var canvas = _this.canvas.current;\n\n      if (canvas) {\n        _this.image.onload = function () {\n          if (_this.image) {\n            canvas.width = _this.image.width;\n            canvas.height = _this.image.height;\n            var ctx = canvas.getContext(\"2d\");\n            ctx.drawImage(_this.image, 0, 0);\n          }\n        };\n\n        _this.image.src = src;\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"activateTool\", function (tool) {\n      if (typeof tool === \"string\") {\n        tool = toolbar[tool];\n      }\n\n      _this.setState({\n        tool: tool\n      }, function () {\n        var tt = tool;\n        typeof tt.onActivate === \"function\" && tt.onActivate({\n          canvas: _this.canvas,\n          options: _this.getToolOptions(tt)\n        });\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"deactivateTool\", function () {\n      _this.setState({\n        tool: null\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"getCanvasDataUrl\", function () {\n      var canvas = _this.canvas.current;\n\n      if (canvas) {\n        var src = _this.props.src;\n\n        if (src.startsWith(\"data:image/jpeg;\")) {\n          return canvas.toDataURL(\"image/jpeg\", 1.0);\n        }\n\n        return canvas.toDataURL();\n      }\n\n      return \"\";\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"applyActiveTool\", /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var tool;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              tool = _this.state.tool;\n\n              if (tool) {\n                _context.next = 3;\n                break;\n              }\n\n              return _context.abrupt(\"return\");\n\n            case 3:\n              _context.t0 = tool.apply;\n\n              if (!_context.t0) {\n                _context.next = 7;\n                break;\n              }\n\n              _context.next = 7;\n              return tool.apply({\n                canvas: _this.canvas\n              });\n\n            case 7:\n              _this.deactivateTool();\n\n            case 8:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    })));\n\n    _defineProperty(_assertThisInitialized(_this), \"cancelActiveTool\", /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var tool;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              tool = _this.state.tool;\n\n              if (tool) {\n                _context2.next = 3;\n                break;\n              }\n\n              return _context2.abrupt(\"return\");\n\n            case 3:\n              _context2.t0 = tool.cancel;\n\n              if (!_context2.t0) {\n                _context2.next = 7;\n                break;\n              }\n\n              _context2.next = 7;\n              return tool.cancel({\n                canvas: _this.canvas\n              });\n\n            case 7:\n              _this.deactivateTool();\n\n            case 8:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    })));\n\n    _defineProperty(_assertThisInitialized(_this), \"getToolOptions\", function (tool) {\n      var options = _this.props.options;\n\n      if (!options || typeof options !== \"object\") {\n        return {};\n      }\n\n      return options[tool.name] || {};\n    });\n\n    return _this;\n  }\n\n  _createClass(ImageEditor, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      initScripts().then(function () {\n        _this2.updateCanvas();\n\n        setTimeout(function () {\n          var options = _this2.props.options;\n\n          if (typeof options === \"object\" && options) {\n            for (var _key2 in options) {\n              if (options[_key2].autoEnable === true) {\n                var tool = toolbar[_key2];\n                tool && _this2.activateTool(tool);\n                break;\n              }\n            }\n          }\n        }, 250);\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      var _this$props = this.props,\n          src = _this$props.src,\n          tools = _this$props.tools,\n          children = _this$props.children;\n      var tool = this.state.tool;\n      var editor = /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Toolbar, null, tools.map(function (key) {\n        var tool = toolbar[key];\n\n        if (!tool) {\n          return null;\n        }\n\n        return /*#__PURE__*/React.createElement(\"div\", {\n          key: key,\n          className: classNames({\n            disabled: _this3.state.tool\n          })\n        }, tool.icon({\n          activateTool: function activateTool() {\n            return _this3.activateTool(tool);\n          }\n        }));\n      })), /*#__PURE__*/React.createElement(ToolOptions, null, tool ? /*#__PURE__*/React.createElement(React.Fragment, null, typeof tool.renderForm === \"function\" && tool.renderForm({\n        options: this.getToolOptions(tool),\n        image: this.image,\n        canvas: this.canvas\n      }), /*#__PURE__*/React.createElement(ApplyCancelActions, null, /*#__PURE__*/React.createElement(ButtonSecondary, {\n        onClick: this.cancelActiveTool\n      }, \"Cancel\"), \"\\xA0\", /*#__PURE__*/React.createElement(ButtonPrimary, {\n        onClick: this.applyActiveTool\n      }, \"Apply\"))) : /*#__PURE__*/React.createElement(\"div\", {\n        style: {\n          textAlign: \"center\"\n        }\n      }, \"Select a tool to start working on your image.\")), /*#__PURE__*/React.createElement(\"div\", {\n        style: {\n          margin: \"0 auto\",\n          textAlign: \"center\"\n        }\n      }, /*#__PURE__*/React.createElement(\"canvas\", {\n        key: src,\n        id: \"canvas\",\n        style: {\n          maxWidth: 700\n        },\n        ref: this.canvas\n      })));\n\n      if (typeof children === \"function\") {\n        return children({\n          render: function render() {\n            return editor;\n          },\n          // canvas: this.canvas,\n          getCanvasDataUrl: this.getCanvasDataUrl,\n          activeTool: this.state.tool,\n          applyActiveTool: this.applyActiveTool,\n          cancelActiveTool: this.cancelActiveTool\n        });\n      }\n\n      return editor;\n    }\n  }]);\n\n  return ImageEditor;\n}(React.Component);\n\n_defineProperty(ImageEditor, \"defaultProps\", {\n  tools: [\"crop\", \"flip\", \"rotate\", \"filter\"]\n});\n\nexport { ImageEditor };","map":null,"metadata":{},"sourceType":"module"}