{"ast":null,"code":"import _get from \"lodash/get\";\nimport { ApolloLink, Observable } from \"apollo-link\";\nimport localStorage from \"store\";\nexport default (function () {\n  var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {\n    token: \"webiny-token\"\n  },\n      token = _ref.token;\n\n  return new ApolloLink(function (operation, forward) {\n    var tokenValue = localStorage.get(token);\n\n    if (tokenValue) {\n      operation.setContext({\n        headers: {\n          Authorization: tokenValue\n        }\n      });\n    }\n\n    var observable = forward(operation);\n    var unsetTokenCodes = [\"TOKEN_EXPIRED\", \"TOKEN_INVALID\"];\n    return new Observable(function (observer) {\n      var subscription = observable.subscribe({\n        next: function next(data) {\n          if (data.errors) {\n            data.errors.forEach(function (error) {\n              var code = _get(error, \"extensions.exception.code\", error.code);\n\n              if (unsetTokenCodes.includes(code)) {\n                localStorage.remove(token);\n              }\n            });\n          }\n\n          return observer.next.bind(observer)(data);\n        },\n        error: observer.error.bind(observer),\n        complete: observer.complete.bind(observer)\n      });\n      return function () {\n        subscription.unsubscribe();\n      };\n    });\n  });\n});","map":null,"metadata":{},"sourceType":"module"}