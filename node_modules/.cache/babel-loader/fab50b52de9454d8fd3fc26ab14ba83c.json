{"ast":null,"code":"import _get from \"lodash/get\";\nimport * as React from \"react\";\nimport { Query } from \"react-apollo\";\nimport { Grid, Cell } from \"@webiny/ui/Grid\";\nimport { Alert } from \"@webiny/ui/Alert\";\nimport { AutoComplete } from \"@webiny/ui/AutoComplete\";\nimport styled from \"@emotion/styled\";\nimport { validation } from \"@webiny/validation\";\nimport { LIST_FORMS } from \"./graphql\";\nvar FormOptionsWrapper = /*#__PURE__*/styled(\"div\", {\n  target: \"e105qjdh0\",\n  label: \"FormOptionsWrapper\"\n})({\n  minHeight: 250\n});\n\nvar getOptions = function getOptions(_ref) {\n  var gqlResponse = _ref.gqlResponse,\n      data = _ref.data;\n  var output = {\n    parents: {\n      options: [],\n      value: null\n    },\n    publishedRevisions: {\n      options: [],\n      value: null\n    }\n  };\n  var selected = {\n    parent: _get(data, \"settings.form.parent\"),\n    revision: _get(data, \"settings.form.revision\")\n  };\n  var parentsList = _get(gqlResponse, \"data.forms.listForms.data\") || [];\n  output.parents.options = parentsList.map(function (_ref2) {\n    var parent = _ref2.parent,\n        name = _ref2.name;\n    return {\n      id: parent,\n      name: name\n    };\n  });\n  output.parents.value = output.parents.options.find(function (item) {\n    return item.id === selected.parent;\n  }) || null;\n  var parent = parentsList.find(function (item) {\n    return item.parent === selected.parent;\n  });\n\n  if (parent) {\n    output.publishedRevisions.options = parent.publishedRevisions.map(function (item) {\n      return {\n        id: item.id,\n        name: \"\".concat(item.name, \" (version \").concat(item.version, \")\")\n      };\n    });\n\n    if (output.publishedRevisions.options.length > 0) {\n      output.publishedRevisions.options.unshift({\n        id: \"latest\",\n        name: \"Latest published revision\"\n      });\n    }\n\n    output.publishedRevisions.value = output.publishedRevisions.options.find(function (item) {\n      return item.id === selected.revision;\n    }) || null;\n  }\n\n  return output;\n};\n\nvar FormElementAdvancedSettings = function FormElementAdvancedSettings(_ref3) {\n  var Bind = _ref3.Bind,\n      data = _ref3.data;\n  return /*#__PURE__*/React.createElement(FormOptionsWrapper, null, /*#__PURE__*/React.createElement(Query, {\n    query: LIST_FORMS,\n    fetchPolicy: \"network-only\"\n  }, function (gqlResponse) {\n    var options = getOptions({\n      gqlResponse: gqlResponse,\n      data: data\n    });\n    return /*#__PURE__*/React.createElement(Grid, null, /*#__PURE__*/React.createElement(Cell, {\n      span: 12\n    }, /*#__PURE__*/React.createElement(Bind, {\n      name: \"settings.form.parent\",\n      validators: validation.create(\"required\")\n    }, function (_ref4) {\n      var onChange = _ref4.onChange;\n      return /*#__PURE__*/React.createElement(AutoComplete, {\n        options: options.parents.options,\n        value: options.parents.value,\n        onChange: onChange,\n        label: \"Form\"\n      });\n    })), /*#__PURE__*/React.createElement(Cell, {\n      span: 12\n    }, /*#__PURE__*/React.createElement(Bind, {\n      name: \"settings.form.revision\",\n      validators: validation.create(\"required\")\n    }, function (_ref5) {\n      var onChange = _ref5.onChange;\n      var parentSelected = !!options.parents.value;\n      var noPublished = options.publishedRevisions.options.length === 0;\n      var description = \"Choose a published revision.\";\n\n      if (parentSelected && noPublished) {\n        return /*#__PURE__*/React.createElement(Alert, {\n          type: \"danger\",\n          title: \"Form not published\"\n        }, \"Please publish the form and then you can insert it into your page.\");\n      } else {\n        return /*#__PURE__*/React.createElement(AutoComplete, {\n          label: \"Revision\",\n          description: description,\n          disabled: !parentSelected || noPublished,\n          options: options.publishedRevisions.options,\n          value: options.publishedRevisions.value,\n          onChange: onChange\n        });\n      }\n    })));\n  }));\n};\n\nexport default FormElementAdvancedSettings;","map":null,"metadata":{},"sourceType":"module"}