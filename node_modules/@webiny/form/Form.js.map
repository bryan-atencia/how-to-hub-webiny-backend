{"version":3,"sources":["../src/Form.tsx"],"names":["React","set","createBind","linkState","ValidationError","Form","data","props","originalData","wasSubmitted","validation","onInvalid","event","preventDefault","setState","validate","then","valid","state","inputNames","Object","keys","inputs","forEach","name","defaultValue","onSubmit","allIsValid","i","length","validators","hasValue","isInputValid","shouldValidate","validateInput","validationResult","Promise","res","setTimeout","validateOnFirstSubmit","resolve","value","hasValidators","formData","isValidating","executeValidators","validationResults","isValid","message","results","catch","validationError","getMessage","beforeChange","afterChange","onChangeFns","linkStateChange","baseOnChange","newValue","cb","onChange","validateFns","e","submitOnEnter","metaKey","ctrlKey","key","isDefaultPrevented","target","blur","stopPropagation","submit","lastRender","includes","children","Error","createElement","onKeyDown","__onKeyDown","setValue","__setValue","form","Bind","invalidFields","Component","disabled","Array","isArray","validator","result"],"mappings":"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","sourcesContent":["import * as React from \"react\";\nimport _ from \"lodash\";\nimport set from \"lodash/fp/set\";\nimport { createBind } from \"./Bind\";\nimport { linkState } from \"./linkState\";\nimport { BindComponent } from \"./Bind\";\nimport ValidationError from \"./ValidationError\";\n\nexport type FormChildrenFunctionParamsSubmit = (\n    event?: React.SyntheticEvent<any, any>\n) => Promise<void>;\n\nexport type FormChildrenFunctionParams = {\n    data: { [key: string]: any };\n    // eslint-disable-next-line @typescript-eslint/no-use-before-define\n    form: Form;\n    submit: FormChildrenFunctionParamsSubmit;\n    Bind: BindComponent;\n    setValue: (name: string, value: any) => void;\n};\n\nexport type FormChildrenFunction = (params: FormChildrenFunctionParams) => React.ReactElement;\n\nexport type FormData = { [key: string]: any };\nexport type Validation = { [key: string]: any };\n\n// eslint-disable-next-line @typescript-eslint/no-use-before-define\nexport type FormOnSubmit = (data: FormData, form?: Form) => void;\n\nexport type FormProps = {\n    invalidFields?: { [key: string]: any };\n    data?: FormData;\n    disabled?: boolean | Function;\n    validateOnFirstSubmit?: boolean;\n    submitOnEnter?: boolean;\n    onSubmit?: FormOnSubmit;\n    onInvalid?: () => void;\n    onChange?: FormOnSubmit;\n    children: FormChildrenFunction;\n};\n\ntype State = {\n    data: FormData;\n    originalData: FormData;\n    wasSubmitted: boolean;\n    validation: Validation;\n};\n\nexport class Form extends React.Component<FormProps, State> {\n    static defaultProps = {\n        data: {},\n        disabled: false,\n        validateOnFirstSubmit: false,\n        onSubmit: null\n    };\n\n    state = {\n        data: this.props.data || {},\n        originalData: this.props.data || {},\n        wasSubmitted: false,\n        validation: {}\n    };\n\n    isValid = null;\n    inputs = {};\n    lastRender = [];\n    validateFns = {};\n    onChangeFns = {};\n    Bind = createBind(this);\n\n    static getDerivedStateFromProps({ data, invalidFields = {} }: FormProps, state: State) {\n        // If we received new `data`, overwrite current `data` in the state\n        if (!_.isEqual(state.originalData, data)) {\n            return { data, originalData: data, validation: {} };\n        }\n\n        // Check for validation errors\n        let validation = _.cloneDeep(state.validation);\n        if (_.isPlainObject(invalidFields) && Object.keys(invalidFields).length) {\n            _.each(invalidFields, (message, name) => {\n                validation = {\n                    ...validation,\n                    [name]: {\n                        isValid: false,\n                        message\n                    }\n                };\n            });\n        }\n\n        // Return new state only if something has changed\n        return !_.isEqual(validation, state.validation) ? { validation } : null;\n    }\n\n    static executeValidators = async (\n        value: any,\n        validators: Function | Array<Function>,\n        formData: Object = {}\n    ): Promise<any> => {\n        validators = Array.isArray(validators) ? [...validators] : [validators];\n\n        const results = {};\n        for (let i = 0; i < validators.length; i++) {\n            const validator = validators[i];\n            try {\n                await Promise.resolve(validator(value, formData))\n                    .then(result => {\n                        if (result instanceof Error) {\n                            throw result;\n                        }\n                        results[i] = result;\n                    })\n                    .catch(e => {\n                        throw new ValidationError(e.message, value);\n                    });\n            } catch (e) {\n                throw new ValidationError(e.message, value);\n            }\n        }\n\n        return results;\n    };\n\n    componentDidUpdate() {\n        Object.keys(this.inputs).forEach(name => {\n            if (!this.lastRender.includes(name)) {\n                delete this.inputs[name];\n                this.setState((state: State) => {\n                    const validation = { ...state.validation };\n                    delete validation[name];\n                    return { validation };\n                });\n            }\n        });\n    }\n\n    onInvalid = () => {\n        if (typeof this.props.onInvalid === \"function\") {\n            this.props.onInvalid();\n        }\n    };\n\n    /**\n     * MAIN FORM ACTION METHODS\n     */\n    submit = (event?: React.SyntheticEvent<any, any>): Promise<void> => {\n        // If event is present - prevent default behaviour\n        if (event && event.preventDefault) {\n            event.preventDefault();\n        }\n\n        this.setState({ wasSubmitted: true });\n\n        return this.validate().then(valid => {\n            if (valid) {\n                let { data } = this.state;\n\n                // Make sure all current inputs have a value in the model (defaultValues do not exist in form data)\n                const inputNames = Object.keys(this.inputs);\n                inputNames.forEach(name => {\n                    const defaultValue = this.inputs[name].defaultValue;\n                    if (!_.has(data, name) && typeof defaultValue !== \"undefined\") {\n                        data = set(name, defaultValue, data);\n                    }\n                });\n\n                if (this.props.onSubmit) {\n                    return this.props.onSubmit(data, this);\n                }\n                return;\n            }\n            return this.onInvalid();\n        });\n    };\n\n    validate = async () => {\n        let allIsValid = true;\n\n        // Inputs must be validated in a queue because we may have async validators\n        const inputNames = Object.keys(this.inputs);\n        for (let i = 0; i < inputNames.length; i++) {\n            const name = inputNames[i];\n            const { validators } = this.inputs[name];\n            if (!validators) {\n                continue;\n            }\n\n            const hasValue = !!_.get(this.state.data, name);\n            const isInputValid = _.get(this.state.validation[name], \"isValid\");\n\n            const shouldValidate = !hasValue || (hasValue && isInputValid !== true);\n\n            if (shouldValidate) {\n                if (isInputValid === false || _.isNil(isInputValid)) {\n                    const validationResult = await this.validateInput(name);\n                    if (validationResult === false) {\n                        allIsValid = false;\n                    }\n                }\n            }\n        }\n\n        return allIsValid;\n    };\n\n    validateInput = async (name: string) => {\n        // Want to know why this nonsense is here?\n        // When you have a <Tabs> component which has an <Input>, and you try to switch tabs\n        // while your input is focused, Tabs end up in an eternal switching loop.\n        // I know this is a `webiny-form` package and has nothing to do with\n        // who uses it from the outside, but there is no time to come up with a better solution :(\n        await new Promise(res => setTimeout(res, 10));\n\n        // Proceed with validation...\n        if ((this.props.validateOnFirstSubmit && !this.state.wasSubmitted) || !this.inputs[name]) {\n            return Promise.resolve(null);\n        }\n        const value = _.get(this.state.data, name, this.inputs[name].defaultValue);\n        const { validators } = this.inputs[name];\n        const hasValidators = _.keys(validators).length;\n\n        // Validate input\n        const formData = {\n            inputs: this.inputs,\n            data: { ...this.state.data }\n        };\n\n        this.setState(state => ({\n            ...state,\n            validation: {\n                ...state.validation,\n                [name]: {\n                    ...state.validation[name],\n                    isValidating: true\n                }\n            }\n        }));\n\n        return Promise.resolve(Form.executeValidators(value, validators, formData))\n            .then(validationResults => {\n                const isValid = hasValidators ? (value === null ? null : true) : null;\n\n                this.setState(state => ({\n                    ...state,\n                    validation: {\n                        ...state.validation,\n                        [name]: {\n                            isValid,\n                            message: null,\n                            results: validationResults\n                        }\n                    }\n                }));\n\n                return validationResults;\n            })\n            .catch(validationError => {\n                // Set component state to reflect validation error\n                this.setState(state => ({\n                    ...state,\n                    validation: {\n                        ...state.validation,\n                        [name]: {\n                            isValid: false,\n                            message: validationError.getMessage(),\n                            results: false\n                        }\n                    }\n                }));\n\n                return false;\n            });\n    };\n\n    getOnChangeFn = ({\n        name,\n        beforeChange,\n        afterChange\n    }: {\n        name: string;\n        beforeChange: any;\n        afterChange: any;\n    }) => {\n        if (!this.onChangeFns[name]) {\n            const linkStateChange = linkState(this, `data.${name}`);\n\n            const baseOnChange = (newValue, cb) => {\n                // When linkState is done processing the value change...\n                return linkStateChange(newValue, cb).then(value => {\n                    // call the Form onChange with updated data\n                    if (typeof this.props.onChange === \"function\") {\n                        this.props.onChange({ ...this.state.data }, this);\n                    }\n\n                    // Execute onAfterChange\n                    afterChange && afterChange(value);\n\n                    return value;\n                });\n            };\n\n            const onChange = beforeChange\n                ? newValue => beforeChange(newValue, baseOnChange)\n                : baseOnChange;\n\n            this.onChangeFns[name] = onChange;\n        }\n\n        return this.onChangeFns[name];\n    };\n\n    getValidateFn = (name: string) => {\n        if (!this.validateFns[name]) {\n            this.validateFns[name] = () => this.validateInput(name);\n        }\n\n        return this.validateFns[name];\n    };\n\n    __setValue = (name: string, value: any) => {\n        this.onChangeFns[name](value);\n    };\n\n    __onKeyDown = (e: React.KeyboardEvent<any>) => {\n        const { submitOnEnter = false } = this.props;\n        if (\n            (submitOnEnter || e.metaKey || e.ctrlKey) &&\n            e.key === \"Enter\" &&\n            !e.isDefaultPrevented()\n        ) {\n            // Need to blur current target in case of input fields to trigger validation\n            // @ts-ignore\n            e.target && e.target.blur();\n            e.preventDefault();\n            e.stopPropagation();\n            // Fire submit with a small delay to allow input validation to complete.\n            // Not an ideal solution but works fine at this point. Will revisit this later.\n            setTimeout(() => this.submit(), 100);\n        }\n    };\n\n    render() {\n        const children = this.props.children;\n        if (!_.isFunction(children)) {\n            throw new Error(\"Form must have a function as its only child!\");\n        }\n\n        this.lastRender = [];\n\n        return React.createElement(\n            \"webiny-form-container\",\n            { onKeyDown: this.__onKeyDown },\n            children({\n                data: _.cloneDeep(this.state.data),\n                setValue: this.__setValue,\n                form: this,\n                submit: this.submit,\n                Bind: this.Bind\n            })\n        );\n    }\n}\n"],"file":"Form.js"}