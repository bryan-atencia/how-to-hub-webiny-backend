{"version":3,"sources":["../../../../../../src/admin/plugins/formDetails/previewContent/HeaderComponents/DeleteForm.tsx"],"names":["React","useApolloClient","useRouter","useSnackbar","IconButton","Tooltip","GET_FORM","DELETE_FORM","ConfirmationDialog","DeleteForm","form","revision","selectRevision","showSnackbar","client","history","parentRevision","parent","id","message","showConfirmation","mutate","mutation","variables","refetchQueries","update","cache","updated","error","push","gqlParams","query","data","readQuery","indexOfDeleted","forms","revisions","findIndex","item","splice","writeQuery","firstRevision"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport { useApolloClient } from \"react-apollo\";\nimport { useRouter } from \"@webiny/react-router\";\nimport { useSnackbar } from \"@webiny/app-admin/hooks/useSnackbar\";\nimport { IconButton } from \"@webiny/ui/Button\";\nimport { Tooltip } from \"@webiny/ui/Tooltip\";\nimport { ReactComponent as DeleteIcon } from \"@webiny/app-form-builder/admin/icons/delete.svg\";\nimport { GET_FORM, DELETE_FORM } from \"@webiny/app-form-builder/admin/viewsGraphql\";\nimport { ConfirmationDialog } from \"@webiny/ui/ConfirmationDialog\";\nimport { cloneDeep, get } from \"lodash\";\n\nconst DeleteForm = ({ form, revision, selectRevision }) => {\n    const { showSnackbar } = useSnackbar();\n    const client = useApolloClient();\n    const { history } = useRouter();\n\n    const parentRevision = revision.parent === revision.id;\n    let message = \"You are about to delete this form revision, are you sure want to continue?\";\n    if (parentRevision) {\n        message =\n            \"You are about to delete this form and all of its revisions. Are you sure want to continue?\";\n    }\n\n    return (\n        <Tooltip content={\"Delete\"} placement={\"top\"}>\n            <ConfirmationDialog title={\"Delete form\"} message={message}>\n                {({ showConfirmation }) => (\n                    <IconButton\n                        icon={<DeleteIcon />}\n                        onClick={() =>\n                            showConfirmation(async () => {\n                                await client.mutate({\n                                    mutation: DELETE_FORM,\n                                    variables: { id: revision.id },\n                                    refetchQueries: [\"FormsListForms\"],\n                                    update: (cache, updated) => {\n                                        const error = get(\n                                            updated,\n                                            \"data.forms.deleteRevision.error\"\n                                        );\n                                        if (error) {\n                                            return showSnackbar(error.message);\n                                        }\n\n                                        showSnackbar(\"Form was deleted successfully!\");\n\n                                        // If the parent was deleted, there's nothing to see here anymore, so\n                                        // we redirect back to the list of all forms.\n                                        if (revision.id === revision.parent) {\n                                            return history.push(\"/forms\");\n                                        }\n\n                                        const gqlParams = {\n                                            query: GET_FORM,\n                                            variables: { id: form.id }\n                                        };\n                                        const data: any = cloneDeep(cache.readQuery(gqlParams));\n                                        const indexOfDeleted = data.forms.form.data.revisions.findIndex(\n                                            item => item.id === revision.id\n                                        );\n\n                                        data.forms.form.data.revisions.splice(indexOfDeleted, 1);\n                                        cache.writeQuery({\n                                            ...gqlParams,\n                                            data\n                                        });\n\n                                        // If currently selected revision (from left list of forms) was deleted,\n                                        // we redirect to the first revision in the list of all form revision.\n                                        const firstRevision = data.forms.form.data.revisions[0];\n                                        selectRevision(firstRevision);\n                                        if (revision.id === form.id) {\n                                            return history.push(\"/forms?id=\" + firstRevision.id);\n                                        }\n                                    }\n                                });\n                            })\n                        }\n                    />\n                )}\n            </ConfirmationDialog>\n        </Tooltip>\n    );\n};\n\nexport default DeleteForm;\n"],"file":"DeleteForm.js"}