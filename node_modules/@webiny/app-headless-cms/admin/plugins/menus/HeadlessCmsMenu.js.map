{"version":3,"sources":["../../../../src/admin/plugins/menus/HeadlessCmsMenu.tsx"],"names":["React","useState","useEffect","i18n","t","ns","Typography","css","useNavigation","EnvironmentSelectorDialog","useCms","useQuery","registerPlugins","unregisterPlugin","getPlugin","getPlugins","LIST_MENU_CONTENT_GROUPS_MODELS","get","style","itemsList","paddingTop","paddingBottom","display","alignItems","icon","width","height","environmentLi","color","environmentLiIcon","environmentLiLabel","marginLeft","whiteSpace","overflow","textOverflow","changeEnvironmentLiLink","HeadlessCmsMenu","Menu","children","dialogOpened","setDialogOpened","hideMenu","currentEnvironment","environments","response","contentModelGroups","cmgHash","reduce","returnValue","currentValue","contentModels","modelId","filter","item","name","startsWith","forEach","group","contentModel","pluginName","type","route","label","toggleMenu","e","preventDefault","stopPropagation"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { i18n } from \"@webiny/app/i18n\";\nconst t = i18n.ns(\"app-headless-cms/admin/menus\");\nimport { ReactComponent as HeadlessCmsIcon } from \"../../icons/devices_other-black-24px.svg\";\nimport { ReactComponent as EnvironmentIcon } from \"../../icons/call_split-24px.svg\";\nimport { Typography } from \"@webiny/ui/Typography\";\nimport { css } from \"emotion\";\nimport { useNavigation } from \"@webiny/app-admin/plugins/Menu/Navigation/components\";\nimport EnvironmentSelectorDialog from \"./../../components/EnvironmentSelectorDialog\";\nimport { useCms } from \"@webiny/app-headless-cms/admin/hooks\";\nimport { useQuery } from \"@webiny/app-headless-cms/admin/hooks\";\nimport { registerPlugins, unregisterPlugin, getPlugin, getPlugins } from \"@webiny/plugins\";\nimport { AdminGlobalSearchPlugin } from \"@webiny/app-admin/types\";\nimport { LIST_MENU_CONTENT_GROUPS_MODELS } from \"./../../viewsGraphql\";\nimport get from \"lodash/get\";\n\nconst style = {\n    itemsList: css({\n        paddingTop: 10,\n        paddingBottom: 10,\n        \"> li\": {\n            display: \"flex\",\n            alignItems: \"center\",\n            paddingTop: 2,\n            paddingBottom: 2\n        }\n    }),\n    icon: css({\n        width: 16,\n        height: 16\n    }),\n    environmentLi: css({\n        color: \"var(--mdc-theme-text-secondary-on-background)\"\n    }),\n    environmentLiIcon: css({\n        width: 16,\n        height: 16\n    }),\n    environmentLiLabel: css({\n        marginLeft: 2,\n        width: 110,\n        whiteSpace: \"nowrap\",\n        overflow: \"hidden\",\n        textOverflow: \"ellipsis\"\n    }),\n    changeEnvironmentLiLink: css({\n        color: \"var(--mdc-theme-primary)\"\n    })\n};\n\nconst HeadlessCmsMenu = ({ Menu, children }) => {\n    const [dialogOpened, setDialogOpened] = useState(false);\n    const { hideMenu } = useNavigation();\n\n    const {\n        environments: { currentEnvironment }\n    } = useCms();\n\n    const response = useQuery(LIST_MENU_CONTENT_GROUPS_MODELS);\n\n    const contentModelGroups = get(response, \"data.listContentModelGroups.data\", []);\n\n    const cmgHash = contentModelGroups.reduce((returnValue, currentValue) => {\n        return (\n            returnValue +\n            currentValue.contentModels.reduce((returnValue, currentValue) => {\n                return returnValue + currentValue.modelId;\n            }, \"\")\n        );\n    }, \"\");\n\n    // Generate \"admin-global-search\" plugins - enables the user to search content via the global search bar.\n    useEffect(() => {\n        // 1. Unregister all previously registered plugins.\n        getPlugins<AdminGlobalSearchPlugin>(\"admin-global-search\")\n            .filter(item => item.name.startsWith(\"admin-global-search-headless-cms\"))\n            .forEach(item => unregisterPlugin(item.name));\n\n        // 2. Register a new set of plugins via the latest list of content models.\n        contentModelGroups.forEach(group => {\n            group.contentModels.forEach(contentModel => {\n                const pluginName = \"admin-global-search-headless-cms-\" + contentModel.modelId;\n                if (!getPlugin(pluginName)) {\n                    registerPlugins({\n                        type: \"admin-global-search\",\n                        name: \"admin-global-search-headless-cms-\" + contentModel.modelId,\n                        route: \"/cms/content-models/manage/\" + contentModel.modelId,\n                        label: contentModel.name\n                    });\n                }\n            });\n        });\n    }, [get(currentEnvironment, \"id\"), cmgHash]);\n\n    return (\n        <Menu\n            onClick={toggleMenu => !dialogOpened && toggleMenu()}\n            name=\"headless-cms\"\n            icon={<HeadlessCmsIcon />}\n            label={\n                <ul className={style.itemsList}>\n                    <li>{t`Headless CMS`}</li>\n                    <li className={style.environmentLi}>\n                        <EnvironmentIcon className={style.environmentLiIcon} />\n                        <Typography use={\"caption\"} className={style.environmentLiLabel}>\n                            {currentEnvironment ? currentEnvironment.name : t`N/A`}\n                        </Typography>\n                    </li>\n                    <li>\n                        <Typography use={\"caption\"}>\n                            <div\n                                className={style.changeEnvironmentLiLink}\n                                onClick={e => {\n                                    e.preventDefault();\n                                    e.stopPropagation();\n                                    setDialogOpened(true);\n                                }}\n                            >{t`Change environment`}</div>\n                        </Typography>\n                        <EnvironmentSelectorDialog\n                            open={dialogOpened}\n                            onClose={() => {\n                                setDialogOpened(false);\n                                hideMenu();\n                            }}\n                        />\n                    </li>\n                </ul>\n            }\n        >\n            {children}\n        </Menu>\n    );\n};\n\nexport default HeadlessCmsMenu;\n"],"file":"HeadlessCmsMenu.js"}