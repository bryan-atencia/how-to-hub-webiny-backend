{"version":3,"sources":["../../../src/admin/plugins/install.tsx"],"names":["React","useState","useEffect","gql","useApolloClient","i18n","Alert","CircularProgress","SimpleForm","SimpleFormContent","styled","SimpleFormPlaceholder","minHeight","minWidth","t","ns","IS_INSTALLED","INSTALL","CMSInstaller","onInstalled","client","error","setError","mutate","mutation","then","data","cms","install","message","setTimeout","plugin","name","type","title","dependencies","secure","isInstalled","query","render"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,OAAOA,KAAP,IAAgBC,QAAhB,EAA0BC,SAA1B,QAA2C,OAA3C;AACA,OAAOC,GAAP,MAAgB,aAAhB;AACA,SAASC,eAAT,QAAgC,cAAhC;AACA,SAASC,IAAT,QAAqB,kBAArB;AACA,SAASC,KAAT,QAAsB,kBAAtB;AACA,SAASC,gBAAT,QAAiC,qBAAjC;AACA,SAASC,UAAT,EAAqBC,iBAArB,QAA8C,yCAA9C;AACA,OAAOC,MAAP,MAAmB,iBAAnB;AAGA,IAAMC,qBAAqB,gBAAGD,MAAH;AAAA;AAAA;AAAA,GAAc;AACrCE,EAAAA,SAAS,EAAE,GAD0B;AAErCC,EAAAA,QAAQ,EAAE;AAF2B,CAAd,CAA3B;AAKA,IAAMC,CAAC,GAAGT,IAAI,CAACU,EAAL,CAAQ,qCAAR,CAAV;AAEA,IAAMC,YAAY,GAAGb,GAAH,mBAAlB;AAcA,IAAMc,OAAO,GAAGd,GAAH,oBAAb;;AAcA,IAAMe,YAAY,GAAG,SAAfA,YAAe,OAAqB;AAAA,MAAlBC,WAAkB,QAAlBA,WAAkB;AACtC,MAAMC,MAAM,GAAGhB,eAAe,EAA9B;;AADsC,kBAEZH,QAAQ,CAAC,IAAD,CAFI;AAAA;AAAA,MAE/BoB,KAF+B;AAAA,MAExBC,QAFwB;;AAItCpB,EAAAA,SAAS,CAAC,YAAM;AACZkB,IAAAA,MAAM,CACDG,MADL,CACY;AACJC,MAAAA,QAAQ,EAAEP;AADN,KADZ,EAIKQ,IAJL,CAIU,iBAAc;AAAA,UAAXC,IAAW,SAAXA,IAAW;AAAA,UACRL,KADQ,GACEK,IAAI,CAACC,GAAL,CAASC,OADX,CACRP,KADQ;;AAEhB,UAAIA,KAAJ,EAAW;AACPC,QAAAA,QAAQ,CAACD,KAAK,CAACQ,OAAP,CAAR;AACA;AACH,OALe,CAOhB;;;AACAC,MAAAA,UAAU,CAACX,WAAD,EAAc,IAAd,CAAV;AACH,KAbL;AAcH,GAfQ,EAeN,EAfM,CAAT;AAiBA,sBACI,oBAAC,UAAD,qBACI,oBAAC,gBAAD;AAAkB,IAAA,KAAK,EAAEL,CAAF;AAAvB,IADJ,EAEKO,KAAK,iBACF,oBAAC,KAAD;AAAO,IAAA,KAAK,EAAEP,CAAF,oBAAZ;AAAuC,IAAA,IAAI,EAAE;AAA7C,KACKO,KADL,CAHR,eAOI,oBAAC,iBAAD,qBACI,oBAAC,qBAAD,OADJ,CAPJ,CADJ;AAaH,CAlCD;;AAoCA,IAAMU,MAA+B,GAAG;AACpCC,EAAAA,IAAI,EAAE,wBAD8B;AAEpCC,EAAAA,IAAI,EAAE,oBAF8B;AAGpCC,EAAAA,KAAK,EAAEpB,CAAF,oBAH+B;AAIpCqB,EAAAA,YAAY,EAAE,EAJsB;AAKpCC,EAAAA,MAAM,EAAE,IAL4B;AAM9BC,EAAAA,WAN8B,8BAMN;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAVjB,cAAAA,MAAU,SAAVA,MAAU;AAAA;AAAA,qBACHA,MAAM,CAACkB,KAAP,CAAa;AAAEA,gBAAAA,KAAK,EAAEtB;AAAT,eAAb,CADG;;AAAA;AAAA;AAClBU,cAAAA,IADkB,uBAClBA,IADkB;AAAA,+CAEnBA,IAAI,CAACC,GAAL,CAASU,WAAT,CAAqBX,IAFF;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAG7B,GATmC;AAUpCa,EAAAA,MAVoC,yBAUZ;AAAA,QAAfpB,WAAe,SAAfA,WAAe;AACpB,wBAAO,oBAAC,YAAD;AAAc,MAAA,WAAW,EAAEA;AAA3B,MAAP;AACH;AAZmC,CAAxC;AAeA,eAAeY,MAAf","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport gql from \"graphql-tag\";\nimport { useApolloClient } from \"react-apollo\";\nimport { i18n } from \"@webiny/app/i18n\";\nimport { Alert } from \"@webiny/ui/Alert\";\nimport { CircularProgress } from \"@webiny/ui/Progress\";\nimport { SimpleForm, SimpleFormContent } from \"@webiny/app-admin/components/SimpleForm\";\nimport styled from \"@emotion/styled\";\nimport { AdminInstallationPlugin } from \"@webiny/app-admin/types\";\n\nconst SimpleFormPlaceholder = styled.div({\n    minHeight: 300,\n    minWidth: 400\n});\n\nconst t = i18n.ns(\"app-headless-cms/admin/installation\");\n\nconst IS_INSTALLED = gql`\n    {\n        cms {\n            isInstalled {\n                data\n                error {\n                    code\n                    message\n                }\n            }\n        }\n    }\n`;\n\nconst INSTALL = gql`\n    mutation InstallCms {\n        cms {\n            install {\n                data\n                error {\n                    code\n                    message\n                }\n            }\n        }\n    }\n`;\n\nconst CMSInstaller = ({ onInstalled }) => {\n    const client = useApolloClient();\n    const [error, setError] = useState(null);\n\n    useEffect(() => {\n        client\n            .mutate({\n                mutation: INSTALL\n            })\n            .then(({ data }) => {\n                const { error } = data.cms.install;\n                if (error) {\n                    setError(error.message);\n                    return;\n                }\n\n                // Just so the user sees the actual message.\n                setTimeout(onInstalled, 3000);\n            });\n    }, []);\n\n    return (\n        <SimpleForm>\n            <CircularProgress label={t`Installing CMS...`} />\n            {error && (\n                <Alert title={t`Something went wrong`} type={\"danger\"}>\n                    {error}\n                </Alert>\n            )}\n            <SimpleFormContent>\n                <SimpleFormPlaceholder />\n            </SimpleFormContent>\n        </SimpleForm>\n    );\n};\n\nconst plugin: AdminInstallationPlugin = {\n    name: \"admin-installation-cms\",\n    type: \"admin-installation\",\n    title: t`Headless CMS`,\n    dependencies: [],\n    secure: true,\n    async isInstalled({ client }) {\n        const { data } = await client.query({ query: IS_INSTALLED });\n        return data.cms.isInstalled.data;\n    },\n    render({ onInstalled }) {\n        return <CMSInstaller onInstalled={onInstalled} />;\n    }\n};\n\nexport default plugin;\n"],"file":"install.js"}