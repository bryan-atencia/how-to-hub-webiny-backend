{"version":3,"sources":["../../../../src/admin/views/ContentModelGroups/DelayedOnChange.ts"],"names":["React","DelayedOnChange","value","callback","delay","clearTimeout","props","onChange","setState","changed","setTimeout","applyValue","state","children","other","newProps","renderProp","child","cloneElement","realOnKeyDown","onKeyDown","realOnBlur","onBlur","e","persist","target","key","Component"],"mappings":"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","sourcesContent":["import * as React from \"react\";\nimport _ from \"lodash\";\n\n/**\n * This component is used to wrap Input and Textarea components to optimize form re-render.\n * These 2 are the only components that trigger form model change on each character input.\n * This means, whenever you type a letter an entire form re-renders.\n * On complex forms you will feel and see a significant delay if this component is not used.\n *\n * The logic behind this component is to serve as a middleware between Form and Input/Textarea, and only notify form of a change when\n * a user stops typing for given period of time (400ms by default).\n */\nclass DelayedOnChange extends React.Component<any> {\n    static defaultProps = {\n        delay: 400\n    };\n\n    delay = null;\n    state = { value: \"\" };\n\n    componentDidMount() {\n        this.setState({ value: this.props.value });\n    }\n\n    applyValue = (value: any, callback: Function = _.noop) => {\n        this.delay && clearTimeout(this.delay);\n        this.delay = null;\n        this.props.onChange(value, callback);\n    };\n\n    onChange = (value: any) => {\n        this.setState({ value }, this.changed);\n    };\n\n    changed = () => {\n        this.delay && clearTimeout(this.delay);\n        this.delay = null;\n        this.delay = setTimeout(() => this.applyValue(this.state.value), this.props.delay);\n    };\n\n    render() {\n        const { children, ...other } = this.props;\n        const newProps = {\n            ...other,\n            value: this.state.value,\n            onChange: this.onChange\n        };\n\n        const renderProp = typeof children === \"function\" ? children : false;\n        const child = renderProp\n            ? renderProp(newProps)\n            : React.cloneElement(children as React.ReactElement, newProps);\n\n        const props = { ...child.props };\n        const realOnKeyDown = props.onKeyDown || _.noop;\n        const realOnBlur = props.onBlur || _.noop;\n\n        // Need to apply value if input lost focus\n        props.onBlur = e => {\n            e.persist();\n            this.applyValue(e.target.value, () => realOnBlur(e));\n        };\n\n        // Need to listen for TAB key to apply new value immediately, without delay. Otherwise validation will be triggered with old value.\n        props.onKeyDown = e => {\n            e.persist();\n            if (e.key === \"Tab\") {\n                this.applyValue(e.target.value, () => realOnKeyDown(e));\n            } else if (e.key === \"Enter\" && props[\"data-on-enter\"]) {\n                this.applyValue(e.target.value, () => realOnKeyDown(e));\n            } else {\n                realOnKeyDown(e);\n            }\n        };\n\n        return React.cloneElement(child, props);\n    }\n}\n\nexport default DelayedOnChange;\n"],"file":"DelayedOnChange.js"}