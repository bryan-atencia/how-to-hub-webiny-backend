{"version":3,"sources":["../../../../../../src/admin/components/ContentModelEditor/Tabs/EditTab/EditTab.tsx"],"names":["React","useCallback","useState","Icon","Center","Vertical","Horizontal","Draggable","EditFieldDialog","Field","rowHandle","EditContainer","fieldHandle","fieldContainer","Row","RowContainer","useContentModelEditor","useI18N","i18n","t","namespace","EditTab","getFields","insertField","updateField","deleteField","data","moveField","moveRow","getFieldPlugin","editingField","setEditingField","dropTarget","setDropTarget","editField","field","undefined","handleDropField","source","pos","type","ui","row","fieldId","layout","index","position","plugin","createField","fields","length","item","map","drag","isDragging","opacity","fieldIndex","_id"],"mappings":"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","sourcesContent":["import React, { useCallback, useState } from \"react\";\nimport { Icon } from \"@webiny/ui/Icon\";\nimport { get, cloneDeep } from \"lodash\";\nimport { Center, Vertical, Horizontal } from \"../../DropZone\";\nimport Draggable from \"../../Draggable\";\nimport EditFieldDialog from \"./EditFieldDialog\";\nimport Field from \"./Field\";\nimport { ReactComponent as HandleIcon } from \"@webiny/app-headless-cms/admin/icons/round-drag_indicator-24px.svg\";\nimport { rowHandle, EditContainer, fieldHandle, fieldContainer, Row, RowContainer } from \"./Styled\";\nimport { useContentModelEditor } from \"@webiny/app-headless-cms/admin/components/ContentModelEditor/Context\";\nimport { CmsEditorContentTab, FieldLayoutPositionType } from \"@webiny/app-headless-cms/types\";\nimport { useI18N } from \"@webiny/app-i18n/hooks/useI18N\";\nimport { i18n } from \"@webiny/app/i18n\";\nconst t = i18n.namespace(\"app-headless-cms/admin/components/editor\");\n\nexport const EditTab: CmsEditorContentTab = () => {\n    const {\n        getFields,\n        insertField,\n        updateField,\n        deleteField,\n        data,\n        moveField,\n        moveRow,\n        getFieldPlugin\n    } = useContentModelEditor();\n\n    const [editingField, setEditingField] = useState(null);\n    const [dropTarget, setDropTarget]: [FieldLayoutPositionType, Function] = useState(null);\n\n    const editField = useCallback(field => {\n        setEditingField(cloneDeep(field));\n    }, undefined);\n\n    const i18n = useI18N();\n\n    const handleDropField = useCallback((source, dropTarget) => {\n        const { pos, type, ui } = source;\n\n        if (ui === \"row\") {\n            // Reorder rows.\n            // Reorder logic is different depending on the source and target position.\n            return moveRow(pos.row, dropTarget.row);\n        }\n\n        // If source pos is set, we are moving an existing field.\n        if (pos) {\n            const fieldId = data.layout[pos.row][pos.index];\n            return moveField({ field: fieldId, position: dropTarget });\n        }\n\n        const plugin = getFieldPlugin({ type });\n        editField(plugin.field.createField({ i18n }));\n        setDropTarget(dropTarget);\n    }, null);\n\n    const fields: Array<any> = getFields(true);\n\n    return (\n        <EditContainer>\n            {fields.length === 0 && (\n                <Center onDrop={item => handleDropField(item, { row: 0, index: 0 })}>\n                    {t`Drop your first field here`}\n                </Center>\n            )}\n\n            {fields.map((row, index) => (\n                <Draggable beginDrag={{ ui: \"row\", pos: { row: index } }} key={index}>\n                    {(\n                        {\n                            drag,\n                            isDragging\n                        } /* RowContainer start - includes drag handle, drop zones and the Row itself. */\n                    ) => (\n                        <RowContainer style={{ opacity: isDragging ? 0.3 : 1 }}>\n                            <div className={rowHandle} ref={drag}>\n                                <Icon icon={<HandleIcon />} />\n                            </div>\n                            <Horizontal\n                                onDrop={item => handleDropField(item, { row: index, index: null })}\n                            />\n                            {/* Row start - includes field drop zones and fields */}\n                            <Row>\n                                {row.map((field, fieldIndex) => (\n                                    <Draggable\n                                        key={fieldIndex}\n                                        beginDrag={{\n                                            ui: \"field\",\n                                            type: field.type,\n                                            pos: {\n                                                row: index,\n                                                index: fieldIndex\n                                            }\n                                        }}\n                                    >\n                                        {({ drag }) => (\n                                            <div className={fieldContainer} ref={drag}>\n                                                <Vertical\n                                                    onDrop={item =>\n                                                        handleDropField(item, {\n                                                            row: index,\n                                                            index: fieldIndex\n                                                        })\n                                                    }\n                                                    isVisible={item =>\n                                                        item.ui === \"field\" &&\n                                                        (row.length < 4 ||\n                                                            get(item, \"pos.row\") === index)\n                                                    }\n                                                />\n\n                                                <div className={fieldHandle}>\n                                                    <Field\n                                                        field={field}\n                                                        onEdit={editField}\n                                                        onDelete={deleteField}\n                                                    />\n                                                </div>\n\n                                                {/* Field end */}\n                                                {fieldIndex === row.length - 1 && (\n                                                    <Vertical\n                                                        last\n                                                        isVisible={item =>\n                                                            item.ui === \"field\" &&\n                                                            (row.length < 4 ||\n                                                                get(item, \"pos.row\") === index)\n                                                        }\n                                                        onDrop={item =>\n                                                            handleDropField(item, {\n                                                                row: index,\n                                                                index: fieldIndex + 1\n                                                            })\n                                                        }\n                                                    />\n                                                )}\n                                            </div>\n                                        )}\n                                    </Draggable>\n                                ))}\n                            </Row>\n                            {/* Row end */}\n                            {index === fields.length - 1 && (\n                                <Horizontal\n                                    last\n                                    onDrop={item =>\n                                        handleDropField(item, {\n                                            row: index + 1,\n                                            index: null\n                                        })\n                                    }\n                                />\n                            )}\n                        </RowContainer>\n                    )}\n                </Draggable>\n            ))}\n\n            <EditFieldDialog\n                field={editingField}\n                onClose={editField}\n                onSubmit={data => {\n                    if (data._id) {\n                        updateField(data);\n                    } else {\n                        insertField(data, dropTarget);\n                    }\n                    editField(null);\n                }}\n            />\n        </EditContainer>\n    );\n};\n"],"file":"EditTab.js"}