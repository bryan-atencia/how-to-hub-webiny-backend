{"version":3,"sources":["../../src/render/index.tsx"],"names":["React","useEffect","Query","query","GoogleTagManager","settings","enabled","window","dataLayer","document","querySelector","prepend","DOMParser","parseFromString","code","firstChild","w","d","s","l","i","push","Date","getTime","event","f","getElementsByTagName","j","createElement","dl","async","src","parentNode","insertBefore","type","name","component","data","loading","googleTagManager","getSettings"],"mappings":"AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,SAASC,KAAT,QAAsB,cAAtB;AACA,OAAOC,KAAP,MAAkB,WAAlB;;AAGA,SAASC,gBAAT,OAAwC;AAAA,MAAZC,QAAY,QAAZA,QAAY;AACpCJ,EAAAA,SAAS,CAAC,YAAM;AACZ;AACA,QAAI,CAACI,QAAD,IAAaA,QAAQ,CAACC,OAAT,KAAqB,IAAlC,IAA0CC,MAAM,CAACC,SAArD,EAAgE;AAC5D;AACH,KAJW,CAMZ;;;AACAC,IAAAA,QAAQ,CAACC,aAAT,CAAuB,MAAvB,EAA+BC,OAA/B,CACI,IAAIJ,MAAM,CAACK,SAAX,GAAuBC,eAAvB,+EAC0ER,QAAQ,CAACS,IADnF,mHAGI,UAHJ,EAIEC,UALN;;AAQA,KAAC,UAASC,CAAT,EAAYC,CAAZ,EAAeC,CAAf,EAAkBC,CAAlB,EAAqBC,CAArB,EAAwB;AACrBJ,MAAAA,CAAC,CAACG,CAAD,CAAD,GAAOH,CAAC,CAACG,CAAD,CAAD,IAAQ,EAAf;AACAH,MAAAA,CAAC,CAACG,CAAD,CAAD,CAAKE,IAAL,CAAU;AAAE,qBAAa,IAAIC,IAAJ,GAAWC,OAAX,EAAf;AAAqCC,QAAAA,KAAK,EAAE;AAA5C,OAAV,EAFqB,CAGrB;;AACA,UAAIC,CAAC,GAAGR,CAAC,CAACS,oBAAF,CAAuBR,CAAvB,EAA0B,CAA1B,CAAR;AAAA,UACIS,CAAC,GAAGV,CAAC,CAACW,aAAF,CAAgBV,CAAhB,CADR;AAAA,UAEIW,EAAE,GAAGV,CAAC,IAAI,WAAL,GAAmB,QAAQA,CAA3B,GAA+B,EAFxC,CAJqB,CAOrB;;AACAQ,MAAAA,CAAC,CAACG,KAAF,GAAU,IAAV,CARqB,CASrB;;AACAH,MAAAA,CAAC,CAACI,GAAF,GAAQ,gDAAgDX,CAAhD,GAAoDS,EAA5D;AACAJ,MAAAA,CAAC,CAACO,UAAF,CAAaC,YAAb,CAA0BN,CAA1B,EAA6BF,CAA7B;AACH,KAZD,EAYGlB,MAZH,EAYWE,QAZX,EAYqB,QAZrB,EAY+B,WAZ/B,EAY4CJ,QAAQ,CAACS,IAZrD;AAaH,GA5BQ,EA4BN,EA5BM,CAAT;AA8BA,SAAO,IAAP;AACH;;AAED,gBAAe;AAAA,SAA4B;AACvCoB,IAAAA,IAAI,EAAE,cADiC;AAEvCC,IAAAA,IAAI,EAAE,iCAFiC;AAGvCC,IAAAA,SAAS,eACL,oBAAC,KAAD;AAAO,MAAA,KAAK,EAAEjC;AAAd,OACK,iBAAuB;AAAA,UAApBkC,IAAoB,SAApBA,IAAoB;AAAA,UAAdC,OAAc,SAAdA,OAAc;AACpB,aAAOA,OAAO,GAAG,IAAH,gBACV,oBAAC,gBAAD;AAAkB,QAAA,QAAQ,EAAED,IAAI,CAACE,gBAAL,CAAsBC,WAAtB,CAAkCH;AAA9D,QADJ;AAGH,KALL;AAJmC,GAA5B;AAAA,CAAf","sourcesContent":["import React, { useEffect } from \"react\";\nimport { Query } from \"react-apollo\";\nimport query from \"./graphql\";\nimport { PbAddonRenderPlugin } from \"@webiny/app-page-builder/types\";\n\nfunction GoogleTagManager({ settings }) {\n    useEffect(() => {\n        // @ts-ignore\n        if (!settings || settings.enabled !== true || window.dataLayer) {\n            return;\n        }\n\n        // eslint-disable\n        document.querySelector(\"body\").prepend(\n            new window.DOMParser().parseFromString(\n                `<noscript><iframe src=\"https://www.googletagmanager.com/ns.html?id=${settings.code}\"\n                  height=\"0\" width=\"0\" style=\"display:none;visibility:hidden\"></iframe></noscript>`,\n                \"text/xml\"\n            ).firstChild\n        );\n\n        (function(w, d, s, l, i) {\n            w[l] = w[l] || [];\n            w[l].push({ \"gtm.start\": new Date().getTime(), event: \"gtm.js\" });\n            // eslint-disable-next-line\n            var f = d.getElementsByTagName(s)[0],\n                j = d.createElement(s),\n                dl = l != \"dataLayer\" ? \"&l=\" + l : \"\";\n            // @ts-ignore\n            j.async = true;\n            // @ts-ignore\n            j.src = \"https://www.googletagmanager.com/gtm.js?id=\" + i + dl;\n            f.parentNode.insertBefore(j, f);\n        })(window, document, \"script\", \"dataLayer\", settings.code);\n    }, []);\n\n    return null;\n}\n\nexport default (): PbAddonRenderPlugin => ({\n    type: \"addon-render\",\n    name: \"addon-render-google-tag-manager\",\n    component: (\n        <Query query={query}>\n            {({ data, loading }) => {\n                return loading ? null : (\n                    <GoogleTagManager settings={data.googleTagManager.getSettings.data} />\n                );\n            }}\n        </Query>\n    )\n});\n"],"file":"index.js"}