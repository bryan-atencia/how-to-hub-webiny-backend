{"version":3,"sources":["../../../../../../src/admin/plugins/pageDetails/header/publishRevision/PublishRevision.tsx"],"names":["React","useState","useCallback","usePublishRevisionHandler","usePageDetails","PublishRevisionDialog","IconButton","Tooltip","getPublishSuggestion","page","revisions","published","id","getPublishableRevisions","filter","r","sort","a","b","Date","savedOn","PublishRevision","publishRevision","publishableRevisions","publishSuggestion","openDialog","setOpenDialog","showDialog","hideDialog","onSubmit","revision","length"],"mappings":";;AAAA,OAAOA,KAAP,IAAgBC,QAAhB,EAA0BC,WAA1B,QAA6C,OAA7C;AACA,SAASC,yBAAT,QAA0C,uCAA1C;AACA,SAASC,cAAT,QAA+B,qDAA/B;AACA,OAAOC,qBAAP,MAAkC,yBAAlC;AACA,SAASC,UAAT,QAA2B,mBAA3B;AACA,SAASC,OAAT,QAAwB,oBAAxB;;;AAIA,SAASC,oBAAT,CAA8BC,IAA9B,EAAoCC,SAApC,EAA+C;AAC3C,MAAI,CAACD,IAAI,CAACE,SAAV,EAAqB;AACjB,WAAOF,IAAI,CAACG,EAAZ;AACH;;AAED,MAAIF,SAAS,CAAC,CAAD,CAAb,EAAkB;AACd,WAAOA,SAAS,CAAC,CAAD,CAAT,CAAaE,EAApB;AACH;;AAED,SAAO,EAAP;AACH;;AAED,SAASC,uBAAT,CAAiCH,SAAjC,EAA4C;AACxC,SAAOA,SAAS,CACXI,MADE,CACK,UAAAC,CAAC;AAAA,WAAI,CAACA,CAAC,CAACJ,SAAP;AAAA,GADN,EAEFK,IAFE,CAEG,UAACC,CAAD,EAAIC,CAAJ,EAAU;AACZ;AACA,WAAO,IAAIC,IAAJ,CAASD,CAAC,CAACE,OAAX,IAAsB,IAAID,IAAJ,CAASF,CAAC,CAACG,OAAX,CAA7B;AACH,GALE,CAAP;AAMH;;AAED,IAAMC,eAAe,GAAG,SAAlBA,eAAkB,GAAM;AAAA,wBACTjB,cAAc,EADL;AAAA,MAClBK,IADkB,mBAClBA,IADkB;;AAAA,8BAEEN,yBAAyB,CAAC;AAAEM,IAAAA,IAAI,EAAJA;AAAF,GAAD,CAF3B;AAAA,MAElBa,eAFkB,yBAElBA,eAFkB;;AAG1B,MAAMC,oBAAoB,GAAGV,uBAAuB,CAAC,KAAIJ,IAAJ,EAAU,WAAV,KAA0B,EAA3B,CAApD;AACA,MAAMe,iBAAiB,GAAGhB,oBAAoB,CAACC,IAAD,EAAOc,oBAAP,CAA9C;;AAJ0B,kBAKUtB,QAAQ,CAAC,KAAD,CALlB;AAAA;AAAA,MAKnBwB,UALmB;AAAA,MAKPC,aALO;;AAO1B,MAAMC,UAAU,GAAGzB,WAAW,CAAC;AAAA,WAAMwB,aAAa,CAAC,IAAD,CAAnB;AAAA,GAAD,EAA4B,EAA5B,CAA9B;AACA,MAAME,UAAU,GAAG1B,WAAW,CAAC;AAAA,WAAMwB,aAAa,CAAC,KAAD,CAAnB;AAAA,GAAD,EAA6B,EAA7B,CAA9B;AAEA,MAAMG,QAAQ,GAAG3B,WAAW,CACxB,UAAA4B,QAAQ,EAAI;AACRF,IAAAA,UAAU;AACV,WAAON,eAAe,CAACQ,QAAD,CAAtB;AACH,GAJuB,EAKxB,CAACR,eAAD,CALwB,CAA5B;;AAQA,MAAI,CAACC,oBAAoB,CAACQ,MAA1B,EAAkC;AAC9B,WAAO,IAAP;AACH;;AAED,sBACI,oBAAC,KAAD,CAAO,QAAP,qBACI,oBAAC,OAAD;AAAS,IAAA,OAAO,EAAE,SAAlB;AAA6B,IAAA,SAAS,EAAE;AAAxC,kBACI,oBAAC,UAAD;AAAY,IAAA,IAAI,eAAE,oBAAC,WAAD,OAAlB;AAAmC,IAAA,OAAO,EAAEJ;AAA5C,IADJ,CADJ,eAII,oBAAC,qBAAD;AACI,IAAA,IAAI,EAAEF,UADV;AAEI,IAAA,OAAO,EAAEG,UAFb;AAGI,IAAA,QAAQ,EAAEC,QAHd;AAII,IAAA,QAAQ,EAAEL,iBAJd;AAKI,IAAA,SAAS,EAAED;AALf,IAJJ,CADJ;AAcH,CApCD;;AAsCA,eAAeF,eAAf","sourcesContent":["import React, { useState, useCallback } from \"react\";\nimport { usePublishRevisionHandler } from \"../../utils/usePublishRevisionHandler\";\nimport { usePageDetails } from \"@webiny/app-page-builder/admin/hooks/usePageDetails\";\nimport PublishRevisionDialog from \"./PublishRevisionDialog\";\nimport { IconButton } from \"@webiny/ui/Button\";\nimport { Tooltip } from \"@webiny/ui/Tooltip\";\nimport { ReactComponent as PublishIcon } from \"@webiny/app-page-builder/admin/assets/round-publish-24px.svg\";\nimport { get } from \"lodash\";\n\nfunction getPublishSuggestion(page, revisions) {\n    if (!page.published) {\n        return page.id;\n    }\n\n    if (revisions[0]) {\n        return revisions[0].id;\n    }\n\n    return \"\";\n}\n\nfunction getPublishableRevisions(revisions) {\n    return revisions\n        .filter(r => !r.published)\n        .sort((a, b) => {\n            // @ts-ignore\n            return new Date(b.savedOn) - new Date(a.savedOn);\n        });\n}\n\nconst PublishRevision = () => {\n    const { page } = usePageDetails();\n    const { publishRevision } = usePublishRevisionHandler({ page });\n    const publishableRevisions = getPublishableRevisions(get(page, \"revisions\") || []);\n    const publishSuggestion = getPublishSuggestion(page, publishableRevisions);\n    const [openDialog, setOpenDialog] = useState(false);\n\n    const showDialog = useCallback(() => setOpenDialog(true), []);\n    const hideDialog = useCallback(() => setOpenDialog(false), []);\n\n    const onSubmit = useCallback(\n        revision => {\n            hideDialog();\n            return publishRevision(revision);\n        },\n        [publishRevision]\n    );\n\n    if (!publishableRevisions.length) {\n        return null;\n    }\n\n    return (\n        <React.Fragment>\n            <Tooltip content={\"Publish\"} placement={\"top\"}>\n                <IconButton icon={<PublishIcon />} onClick={showDialog} />\n            </Tooltip>\n            <PublishRevisionDialog\n                open={openDialog}\n                onClose={hideDialog}\n                onSubmit={onSubmit}\n                selected={publishSuggestion}\n                revisions={publishableRevisions}\n            />\n        </React.Fragment>\n    );\n};\n\nexport default PublishRevision;\n"],"file":"PublishRevision.js"}