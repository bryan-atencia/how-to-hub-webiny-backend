{"version":3,"sources":["../../../src/admin/components/EditorPluginsLoader.tsx"],"names":["React","useEffect","useReducer","registerPlugins","CircularProgress","globalState","render","editor","EditorPluginsLoader","children","location","state","newState","loaded","setLoaded","loadPlugins","pathname","startsWith","renderPlugins","default","Promise","all","filter","Boolean","plugins","map","p"],"mappings":";;;;AAAA,OAAOA,KAAP,IAAgBC,SAAhB,EAA2BC,UAA3B,QAA6C,OAA7C;AACA,SAASC,eAAT,QAAgC,iBAAhC;AACA,SAASC,gBAAT,QAAiC,qBAAjC;AAEA,IAAMC,WAAW,GAAG;AAAEC,EAAAA,MAAM,EAAE,KAAV;AAAiBC,EAAAA,MAAM,EAAE;AAAzB,CAApB;AAEA,OAAO,SAASC,mBAAT,OAAqD;AAAA,MAAtBC,QAAsB,QAAtBA,QAAsB;AAAA,MAAZC,QAAY,QAAZA,QAAY;;AAAA,oBAC5BR,UAAU,CAClC,UAACS,KAAD,EAAQC,QAAR;AAAA,2CAA2BD,KAA3B,GAAqCC,QAArC;AAAA,GADkC,EAElCP,WAFkC,CADkB;AAAA;AAAA,MACjDQ,MADiD;AAAA,MACzCC,SADyC;;AAAA,WAMzCC,WANyC;AAAA;AAAA;;AAAA;AAAA,4EAMxD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAEQL,QAAQ,CAACM,QAAT,CAAkBC,UAAlB,CAA6B,qBAA7B,KAAuD,CAACJ,MAAM,CAACP,MAFvE;AAAA;AAAA;AAAA;;AAAA;AAAA,qBAGoC,OAAO,iDAAP,CAHpC;;AAAA;AAGcY,cAAAA,aAHd;AAIQf,cAAAA,eAAe,CAACe,aAAa,CAACC,OAAd,EAAD,CAAf;AAEAd,cAAAA,WAAW,CAACC,MAAZ,GAAqB,IAArB;AACAQ,cAAAA,SAAS,CAAC;AAAER,gBAAAA,MAAM,EAAE;AAAV,eAAD,CAAT;;AAPR;AAAA,oBAWQI,QAAQ,CAACM,QAAT,CAAkBC,UAAlB,CAA6B,sBAA7B,KAAwD,CAACJ,MAAM,CAACN,MAXxE;AAAA;AAAA;AAAA;;AAAA;AAAA,qBAY8Ba,OAAO,CAACC,GAAR,CAClB,CACI,OAAO,8BAAP,CADJ,EAEI,CAACR,MAAM,CAACP,MAAR,GACM,OAAO,iDAAP,CADN,GAEM,IAJV,EAKEgB,MALF,CAKSC,OALT,CADkB,CAZ9B;;AAAA;AAYcC,cAAAA,OAZd;AAoBQrB,cAAAA,eAAe,CAACqB,OAAO,CAACC,GAAR,CAAY,UAAAC,CAAC;AAAA,uBAAIA,CAAC,CAACP,OAAF,EAAJ;AAAA,eAAb,CAAD,CAAf;AAEAd,cAAAA,WAAW,CAACE,MAAZ,GAAqB,IAArB;AACAF,cAAAA,WAAW,CAACC,MAAZ,GAAqB,IAArB;AAEAQ,cAAAA,SAAS,CAAC;AAAEP,gBAAAA,MAAM,EAAE,IAAV;AAAgBD,gBAAAA,MAAM,EAAE;AAAxB,eAAD,CAAT;;AAzBR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KANwD;AAAA;AAAA;;AAmCxDL,EAAAA,SAAS,CAAC,YAAM;AACZc,IAAAA,WAAW;AACd,GAFQ,EAEN,EAFM,CAAT;;AAIA,MAAIL,QAAQ,CAACM,QAAT,CAAkBC,UAAlB,CAA6B,qBAA7B,KAAuDJ,MAAM,CAACP,MAAlE,EAA0E;AACtE,WAAOG,QAAP;AACH;;AAED,MAAIC,QAAQ,CAACM,QAAT,CAAkBC,UAAlB,CAA6B,sBAA7B,KAAwDJ,MAAM,CAACN,MAAnE,EAA2E;AACvE,WAAOE,QAAP;AACH;;AAED,sBAAO,oBAAC,gBAAD,OAAP;AACH","sourcesContent":["import React, { useEffect, useReducer } from \"react\";\nimport { registerPlugins } from \"@webiny/plugins\";\nimport { CircularProgress } from \"@webiny/ui/Progress\";\n\nconst globalState = { render: false, editor: false };\n\nexport function EditorPluginsLoader({ children, location }) {\n    const [loaded, setLoaded] = useReducer(\n        (state, newState) => ({ ...state, ...newState }),\n        globalState\n    );\n\n    async function loadPlugins() {\n        // If we are on pages list route, import plugins required to render the page content.\n        if (location.pathname.startsWith(\"/page-builder/pages\") && !loaded.render) {\n            const renderPlugins = await import(\"@webiny/app-page-builder/render/presets/default\");\n            registerPlugins(renderPlugins.default());\n\n            globalState.render = true;\n            setLoaded({ render: true });\n        }\n\n        // If we are on the Editor route, import plugins required to render both editor and preview.\n        if (location.pathname.startsWith(\"/page-builder/editor\") && !loaded.editor) {\n            const plugins = await Promise.all(\n                [\n                    import(\"../../editor/presets/default\") as Promise<any>,\n                    !loaded.render\n                        ? import(\"@webiny/app-page-builder/render/presets/default\")\n                        : null\n                ].filter(Boolean)\n            );\n            registerPlugins(plugins.map(p => p.default()));\n\n            globalState.editor = true;\n            globalState.render = true;\n\n            setLoaded({ editor: true, render: true });\n        }\n    }\n\n    useEffect(() => {\n        loadPlugins();\n    }, []);\n\n    if (location.pathname.startsWith(\"/page-builder/pages\") && loaded.render) {\n        return children;\n    }\n\n    if (location.pathname.startsWith(\"/page-builder/editor\") && loaded.editor) {\n        return children;\n    }\n\n    return <CircularProgress />;\n}\n"],"file":"EditorPluginsLoader.js"}