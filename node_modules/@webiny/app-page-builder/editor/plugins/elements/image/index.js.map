{"version":3,"sources":["../../../../../src/editor/plugins/elements/image/index.tsx"],"names":["React","styled","getPlugins","ELEMENT_CREATED","ImageSettings","Image","Action","PreviewBox","textAlign","height","svg","width","name","type","elementType","toolbar","title","group","preview","settings","image","alignments","target","create","options","elements","data","horizontalAlign","margin","desktop","all","mobile","top","left","right","bottom","advanced","padding","render","element","renderAction","renderMenu","actions","middleware","action","next","payload","source","imagePlugin","find","pl","onCreate","setTimeout","document","querySelector","window","CSS","escape","id","click"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport styled from \"@emotion/styled\";\nimport { getPlugins } from \"@webiny/plugins\";\nimport { ELEMENT_CREATED } from \"@webiny/app-page-builder/editor/actions\";\nimport { ReactComponent as ImageIcon } from \"./round-image-24px.svg\";\nimport ImageSettings from \"./ImageSettings\";\nimport Image from \"./Image\";\nimport Action from \"../../elementSettings/components/Action\";\nimport {\n    PbEditorReduxMiddlewarePlugin,\n    PbEditorPageElementPlugin,\n    PbEditorPageElementSettingsPlugin\n} from \"@webiny/app-page-builder/types\";\n\nexport default () => {\n    const PreviewBox = styled(\"div\")({\n        textAlign: \"center\",\n        height: 50,\n        svg: {\n            height: 50,\n            width: 50\n        }\n    });\n\n    return [\n        {\n            name: \"pb-editor-page-element-image\",\n            type: \"pb-editor-page-element\",\n            elementType: \"image\",\n            toolbar: {\n                title: \"Image\",\n                group: \"pb-editor-element-group-basic\",\n                preview() {\n                    return (\n                        <PreviewBox>\n                            <ImageIcon />\n                        </PreviewBox>\n                    );\n                }\n            },\n            settings: [\n                \"pb-editor-page-element-settings-image\",\n                [\"pb-editor-page-element-settings-background\", { image: false }],\n                \"pb-editor-page-element-settings-link\",\n                \"\",\n                \"pb-editor-page-element-settings-border\",\n                \"pb-editor-page-element-settings-shadow\",\n                \"\",\n                [\n                    \"pb-editor-page-element-settings-horizontal-align\",\n                    { alignments: [\"left\", \"center\", \"right\"] }\n                ],\n                \"pb-editor-page-element-settings-padding\",\n                \"pb-editor-page-element-settings-margin\",\n                \"\",\n                \"pb-editor-page-element-settings-clone\",\n                \"pb-editor-page-element-settings-delete\",\n                \"\"\n            ],\n            target: [\"column\", \"row\"],\n            create(options) {\n                return {\n                    type: \"image\",\n                    elements: [],\n                    data: {\n                        settings: {\n                            horizontalAlign: \"center\",\n                            margin: {\n                                desktop: { all: 0 },\n                                mobile: { top: 0, left: 0, right: 0, bottom: 15 },\n                                advanced: true\n                            },\n                            padding: {\n                                desktop: { all: 0 },\n                                mobile: { all: 0 }\n                            }\n                        }\n                    },\n                    ...options\n                };\n            },\n            render({ element }) {\n                return <Image element={element} />;\n            }\n        } as PbEditorPageElementPlugin,\n        {\n            name: \"pb-editor-page-element-settings-image\",\n            type: \"pb-editor-page-element-settings\",\n            renderAction() {\n                return <Action plugin={this.name} tooltip={\"Image\"} icon={<ImageIcon />} />;\n            },\n            renderMenu() {\n                return <ImageSettings />;\n            }\n        } as PbEditorPageElementSettingsPlugin,\n        {\n            type: \"pb-editor-redux-middleware\",\n            name: \"pb-editor-redux-middleware-image-created\",\n            actions: [ELEMENT_CREATED],\n            middleware: ({ action, next }) => {\n                const { element, source } = action.payload;\n\n                next(action);\n\n                if (element.type !== \"image\") {\n                    return;\n                }\n\n                // Check the source of the element (could be `saved` element which behaves differently from other elements)\n                const imagePlugin = getPlugins<PbEditorPageElementPlugin>(\"pb-editor-page-element\").find(\n                    pl => pl.elementType === source.type\n                );\n\n                if (!imagePlugin) {\n                    return;\n                }\n\n                const { onCreate } = imagePlugin;\n                if (!onCreate || onCreate !== \"skip\") {\n                    // If source element does not define a specific `onCreate` behavior - continue with the actual element plugin\n                    // TODO: this isn't an ideal approach, implement a retry mechanism which polls for DOM element\n                    setTimeout(() => {\n                        const image: HTMLElement = document.querySelector(\n                            `#${window.CSS.escape(element.id)} [data-role=\"select-image\"]`\n                        );\n\n                        if (image) {\n                            image.click();\n                        }\n                    }, 100);\n                }\n            }\n        } as PbEditorReduxMiddlewarePlugin\n    ];\n};\n"],"file":"index.js"}