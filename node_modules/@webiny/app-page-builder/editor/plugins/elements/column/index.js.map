{"version":3,"sources":["../../../../../src/editor/plugins/elements/column/index.tsx"],"names":["React","styled","set","redux","Column","createElement","createColumn","cloneElement","addElementToParent","updateElement","deleteElement","elementCreated","getParentElementWithChildren","PreviewBox","textAlign","height","svg","width","name","type","elementType","toolbar","title","group","preview","settings","target","create","options","data","margin","desktop","all","mobile","padding","elements","render","props","canDelete","element","parent","store","getState","id","length","onReceived","source","position","droppedOnCenter","splitColumn","handleDroppedElement","dispatchNew","path","dispatch","row","targetIndex","findIndex","el","newColumn"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport styled from \"@emotion/styled\";\nimport { set } from \"dot-prop-immutable\";\nimport { redux } from \"@webiny/app-page-builder/editor/redux\";\nimport Column from \"./Column\";\nimport {\n    createElement,\n    createColumn,\n    cloneElement,\n    addElementToParent\n} from \"@webiny/app-page-builder/editor/utils\";\nimport {\n    updateElement,\n    deleteElement,\n    elementCreated\n} from \"@webiny/app-page-builder/editor/actions\";\nimport { getParentElementWithChildren } from \"@webiny/app-page-builder/editor/selectors\";\nimport { ReactComponent as ColumnIcon } from \"@webiny/app-page-builder/editor/assets/icons/column-icon.svg\";\nimport { PbEditorPageElementPlugin } from \"@webiny/app-page-builder/types\";\n\nexport default (): PbEditorPageElementPlugin => {\n    const PreviewBox = styled(\"div\")({\n        textAlign: \"center\",\n        height: 50,\n        svg: {\n            height: 50,\n            width: 50\n        }\n    });\n\n    return {\n        name: \"pb-editor-page-element-column\",\n        type: \"pb-editor-page-element\",\n        elementType: \"column\",\n        toolbar: {\n            title: \"Column\",\n            group: \"pb-editor-element-group-layout\",\n            preview() {\n                return (\n                    <PreviewBox>\n                        <ColumnIcon />\n                    </PreviewBox>\n                );\n            }\n        },\n        settings: [\n            \"pb-editor-page-element-settings-background\",\n            \"pb-editor-page-element-settings-animation\",\n            \"\",\n            \"pb-editor-page-element-settings-border\",\n            \"pb-editor-page-element-settings-shadow\",\n            \"\",\n            \"pb-editor-page-element-settings-padding\",\n            \"pb-editor-page-element-settings-margin\",\n            \"pb-editor-page-element-settings-horizontal-align\",\n            \"pb-editor-page-element-settings-vertical-align\",\n            \"\",\n            \"pb-editor-page-element-settings-clone\",\n            \"pb-editor-page-element-settings-delete\",\n            \"\"\n        ],\n        target: [\"row\"],\n        create(options = {}) {\n            return {\n                type: \"column\",\n                data: {\n                    ...(options.data || {}),\n                    settings: {\n                        margin: {\n                            desktop: { all: 0 },\n                            mobile: { all: 0 }\n                        },\n                        padding: {\n                            desktop: { all: 0 },\n                            mobile: { all: 0 }\n                        }\n                    }\n                },\n                elements: options.elements || []\n            };\n        },\n        render(props) {\n            return <Column {...props} />;\n        },\n        canDelete({ element }) {\n            const parent = getParentElementWithChildren(redux.store.getState(), element.id);\n            return parent.elements.length > 1;\n        },\n        onReceived({ source, target, position = null }) {\n            const droppedOnCenter = position === null;\n\n            // Dropped a column onto a center drop zone\n            if (source.type === \"column\" && droppedOnCenter) {\n                return splitColumn(source, target);\n            }\n\n            handleDroppedElement(source, target, position);\n        }\n    };\n};\n\nconst handleDroppedElement = (source, target, position) => {\n    let dispatchNew = false;\n    let element;\n\n    if (source.path) {\n        element = cloneElement(source);\n    } else {\n        dispatchNew = true;\n        element = createElement(source.type, {}, target);\n    }\n\n    target = addElementToParent(element, target, position);\n    redux.store.dispatch(updateElement({ element: target }));\n\n    if (source.path) {\n        redux.store.dispatch(deleteElement({ element: source }));\n    }\n\n    if (dispatchNew) {\n        redux.store.dispatch(elementCreated({ element, source }));\n    }\n};\n\nconst splitColumn = (source, target) => {\n    let dispatchNew = false;\n    let row = getParentElementWithChildren(redux.store.getState(), target.id);\n    const targetIndex = row.elements.findIndex(el => el.id === target.id);\n\n    // Split target column in half\n    row.elements[targetIndex].data.width /= 2;\n\n    // Create a new column with half of the original target width\n    let newColumn;\n    if (source.path) {\n        newColumn = cloneElement(source);\n    } else {\n        dispatchNew = true;\n        newColumn = createColumn();\n    }\n\n    newColumn = set(newColumn, \"data.width\", row.elements[targetIndex].data.width);\n\n    row = addElementToParent(newColumn, row, targetIndex + 1);\n    redux.store.dispatch(updateElement({ element: row }));\n\n    if (source.path) {\n        redux.store.dispatch(deleteElement({ element: source }));\n    }\n\n    if (dispatchNew) {\n        redux.store.dispatch(elementCreated({ element: newColumn, source }));\n    }\n};\n"],"file":"index.js"}