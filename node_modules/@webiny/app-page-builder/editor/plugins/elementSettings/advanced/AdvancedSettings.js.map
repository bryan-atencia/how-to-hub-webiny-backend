{"version":3,"sources":["../../../../../src/editor/plugins/elementSettings/advanced/AdvancedSettings.tsx"],"names":["React","useCallback","useEffect","connect","merge","getPlugins","renderPlugins","isPluginActive","withActiveElement","useKeyHandler","useHandler","css","Dialog","DialogContent","DialogActions","DialogButton","DialogCancel","DialogTitle","Form","Tabs","updateElement","deactivatePlugin","emptyElement","data","type","dialogStyle","maxWidth","width","maxHeight","AdvancedSettings","props","element","open","addKeyHandler","removeKeyHandler","closeDialog","name","onSubmit","formData","plugins","filter","pl","elementType","reduce","onSave","id","submit","Bind","form","wrapper","withConnect","state","shallow","memo","prev","next"],"mappings":"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","sourcesContent":["import React, { useCallback, useEffect } from \"react\";\nimport { connect } from \"@webiny/app-page-builder/editor/redux\";\nimport { cloneDeep } from \"lodash\";\nimport { merge } from \"dot-prop-immutable\";\nimport { getPlugins } from \"@webiny/plugins\";\nimport { renderPlugins } from \"@webiny/app/plugins\";\nimport { isPluginActive } from \"@webiny/app-page-builder/editor/selectors\";\nimport { withActiveElement } from \"@webiny/app-page-builder/editor/components\";\nimport { useKeyHandler } from \"@webiny/app-page-builder/editor/hooks/useKeyHandler\";\nimport { useHandler } from \"@webiny/app/hooks/useHandler\";\nimport { css } from \"emotion\";\nimport {\n    Dialog,\n    DialogContent,\n    DialogActions,\n    DialogButton,\n    DialogCancel,\n    DialogTitle\n} from \"@webiny/ui/Dialog\";\nimport { Form } from \"@webiny/form\";\nimport { Tabs } from \"@webiny/ui/Tabs\";\nimport { updateElement, deactivatePlugin } from \"@webiny/app-page-builder/editor/actions\";\nimport { PbEditorPageElementAdvancedSettingsPlugin } from \"@webiny/app-page-builder/types\";\n\nconst emptyElement = { data: {}, type: null };\n\nconst dialogStyle = css({\n    \".mdc-dialog__surface\": {\n        maxWidth: 865\n    },\n    \".webiny-ui-dialog__content\": {\n        width: 865,\n        maxHeight: \"70vh\"\n    }\n});\n\nconst AdvancedSettings = props => {\n    const { element, open, deactivatePlugin } = props;\n    const { data, type } = element || cloneDeep(emptyElement);\n\n    const { addKeyHandler, removeKeyHandler } = useKeyHandler();\n\n    const closeDialog = useCallback(() => {\n        deactivatePlugin({ name: \"pb-editor-page-element-settings-advanced\" });\n    }, []);\n\n    const onSubmit = useHandler(props, ({ element, updateElement }) => (formData: FormData) => {\n        // Get element settings plugins\n        const plugins = getPlugins<PbEditorPageElementAdvancedSettingsPlugin>(\n            \"pb-editor-page-element-advanced-settings\"\n        ).filter(pl => pl.elementType === element.type);\n\n        formData = plugins.reduce((formData, pl) => {\n            if (pl.onSave) {\n                return pl.onSave(formData);\n            }\n            return formData;\n        }, formData);\n\n        updateElement({\n            element: merge(element, \"data\", formData)\n        });\n        closeDialog();\n    });\n\n    useEffect(() => {\n        open ? addKeyHandler(\"escape\", closeDialog) : removeKeyHandler(\"escape\");\n    });\n\n    return (\n        <Dialog\n            open={open}\n            onClose={closeDialog}\n            className={dialogStyle}\n            data-testid={\"pb-editor-advanced-element-settings-dialog\"}\n        >\n            <DialogTitle>Settings</DialogTitle>\n            <Form key={element && element.id} data={data} onSubmit={onSubmit}>\n                {({ submit, Bind, data, form }) => (\n                    <React.Fragment>\n                        <DialogContent>\n                            <Tabs>\n                                {renderPlugins<PbEditorPageElementAdvancedSettingsPlugin>(\n                                    \"pb-editor-page-element-advanced-settings\",\n                                    { Bind, data, form },\n                                    { wrapper: false, filter: pl => pl.elementType === type }\n                                )}\n                            </Tabs>\n                        </DialogContent>\n                        <DialogActions>\n                            <DialogCancel>Cancel</DialogCancel>\n                            <DialogButton onClick={submit}>Save</DialogButton>\n                        </DialogActions>\n                    </React.Fragment>\n                )}\n            </Form>\n        </Dialog>\n    );\n};\n\nconst withConnect = connect<any, any, any>(\n    state => ({\n        open: isPluginActive(\"pb-editor-page-element-settings-advanced\")(state)\n    }),\n    { updateElement, deactivatePlugin }\n);\n\nexport default withConnect(\n    withActiveElement({ shallow: true })(\n        React.memo(AdvancedSettings, (prev, next) => prev.open === next.open)\n    )\n);\n"],"file":"AdvancedSettings.js"}