{"version":3,"sources":["../../../../../../src/editor/plugins/elementSettings/save/SaveDialog/domToImage.ts"],"names":["util","newUtil","inliner","newInliner","fontFaces","newFontFaces","images","newImages","defaultOptions","imagePlaceholder","undefined","cacheBust","domtoimage","toPng","impl","options","toSvg","node","copyOptions","Promise","resolve","then","cloneNode","filter","embedFonts","inlineImages","applyOptions","clone","onDocument","makeSvgDataUri","width","height","style","draw","canvas","toDataURL","domNode","makeImage","delay","image","document","createElement","aspect","getContext","drawImage","root","makeNodeCopy","cloneChildren","processClone","HTMLCanvasElement","original","children","childNodes","length","cloneChildrenInOrder","asArray","parent","done","forEach","child","childClone","appendChild","Element","cloneStyle","clonePseudoElements","copyUserInput","fixSvg","copyStyle","window","getComputedStyle","source","target","cssText","copyProperties","name","setProperty","getPropertyValue","getPropertyPriority","element","clonePseudoElement","content","className","uid","styleElement","formatPseudoElementStyle","selector","formatCssText","formatCssProperties","createTextNode","map","formatProperty","join","HTMLTextAreaElement","innerHTML","value","HTMLInputElement","setAttribute","SVGElement","SVGRectElement","attribute","getAttribute","resolveAll","styleNode","inlineAll","XMLSerializer","serializeToString","escapeXhtml","xhtml","foreignObject","svg","escape","mimeType","dataAsUrl","isDataUrl","resolveUrl","getAndEncode","mimes","WOFF","JPEG","woff","woff2","ttf","eot","png","jpg","jpeg","gif","tiff","parseExtension","url","match","exec","extension","toLowerCase","split","search","toBlob","binaryString","atob","binaryArray","Uint8Array","i","charCodeAt","Blob","type","canvasToBlob","baseUrl","doc","implementation","createHTMLDocument","base","head","a","body","href","index","fourRandomChars","Math","random","pow","toString","slice","uri","reject","Image","onload","onerror","src","TIMEOUT","test","Date","getTime","request","XMLHttpRequest","onreadystatechange","ontimeout","timeout","responseType","open","send","placeholder","readyState","status","fail","encoder","FileReader","onloadend","result","readAsDataURL","response","message","console","error","string","replace","ms","arg","setTimeout","arrayLike","array","push","leftBorder","px","rightBorder","scrollWidth","topBorder","bottomBorder","scrollHeight","styleProperty","parseFloat","URL_REGEX","shouldProcess","readUrls","inline","get","data","dataUrl","urlAsRegex","RegExp","nothingToInline","urls","readAll","webFonts","all","webFont","cssStrings","styleSheets","getCssRules","selectWebFontRules","rules","newWebFont","cssRules","rule","CSSRule","FONT_FACE_RULE","sheet","hasOwnProperty","bind","e","log","webFontRule","parentStyleSheet","newImage","removeAttribute","inlineBackground","HTMLImageElement","background","inlined"],"mappings":"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","sourcesContent":["// @ts-nocheck\n/* eslint-disable */\n\nconst util = newUtil();\nconst inliner = newInliner();\nconst fontFaces = newFontFaces();\nconst images = newImages();\n\n// Default impl options\nconst defaultOptions = {\n    // Default is to fail on error, no placeholder\n    imagePlaceholder: undefined,\n    // No caching by default\n    cacheBust: true\n};\n\nconst domtoimage = {\n    toPng,\n    impl: {\n        fontFaces: fontFaces,\n        images: images,\n        util: util,\n        inliner: inliner,\n        options: {}\n    }\n};\n\nexport default domtoimage;\n\nfunction toSvg(node, options) {\n    options = options || {};\n    copyOptions(options);\n    return Promise.resolve(node)\n        .then(function(node) {\n            return cloneNode(node, options.filter, true);\n        })\n        .then(embedFonts)\n        .then(inlineImages)\n        .then(applyOptions)\n        .then(function(clone) {\n            if (typeof options.onDocument === \"function\") {\n                clone = options.onDocument(clone);\n            }\n            return makeSvgDataUri(clone, util.width(node), util.height(node));\n        });\n\n    function applyOptions(clone) {\n        if (options.width) clone.style.width = options.width + \"px\";\n        if (options.height) clone.style.height = options.height + \"px\";\n\n        return clone;\n    }\n}\n\n/**\n * @param {Node} node - The DOM Node object to render\n * @param {Object} options - Rendering options, @see {@link toSvg}\n * @return {Promise} - A promise that is fulfilled with a PNG image data URL\n * */\nfunction toPng(node, options) {\n    return draw(node, options || {}).then(function(canvas) {\n        return canvas.toDataURL();\n    });\n}\n\nfunction copyOptions(options) {\n    // Copy options to impl options for use in impl\n    if (typeof options.imagePlaceholder === \"undefined\") {\n        domtoimage.impl.options.imagePlaceholder = defaultOptions.imagePlaceholder;\n    } else {\n        domtoimage.impl.options.imagePlaceholder = options.imagePlaceholder;\n    }\n\n    if (typeof options.cacheBust === \"undefined\") {\n        domtoimage.impl.options.cacheBust = defaultOptions.cacheBust;\n    } else {\n        domtoimage.impl.options.cacheBust = options.cacheBust;\n    }\n}\n\nfunction draw(domNode, options) {\n    return toSvg(domNode, options)\n        .then(util.makeImage)\n        .then(util.delay(100))\n        .then(function(image) {\n            const canvas = document.createElement(\"canvas\");\n            const { width } = options;\n            const aspect = image.width / image.height;\n            const height = width / aspect;\n\n            canvas.width = width;\n            canvas.height = height;\n\n            canvas\n                .getContext(\"2d\")\n                .drawImage(image, 0, 0, image.width, image.height, 0, 0, width, height);\n\n            return canvas;\n        });\n}\n\nfunction cloneNode(node, filter, root) {\n    if (!root && filter && !filter(node)) return Promise.resolve();\n\n    return Promise.resolve(node)\n        .then(makeNodeCopy)\n        .then(function(clone) {\n            return cloneChildren(node, clone, filter);\n        })\n        .then(function(clone) {\n            return processClone(node, clone);\n        });\n\n    function makeNodeCopy(node) {\n        if (node instanceof HTMLCanvasElement) return util.makeImage(node.toDataURL());\n        return node.cloneNode(false);\n    }\n\n    function cloneChildren(original, clone, filter) {\n        var children = original.childNodes;\n        if (children.length === 0) return Promise.resolve(clone);\n\n        return cloneChildrenInOrder(clone, util.asArray(children), filter).then(function() {\n            return clone;\n        });\n\n        function cloneChildrenInOrder(parent, children, filter) {\n            var done = Promise.resolve();\n            children.forEach(function(child) {\n                done = done\n                    .then(() => cloneNode(child, filter))\n                    .then(function(childClone) {\n                        if (childClone) parent.appendChild(childClone);\n                    });\n            });\n            return done;\n        }\n    }\n\n    function processClone(original, clone) {\n        if (!(clone instanceof Element)) return clone;\n\n        return Promise.resolve()\n            .then(cloneStyle)\n            .then(clonePseudoElements)\n            .then(copyUserInput)\n            .then(fixSvg)\n            .then(function() {\n                return clone;\n            });\n\n        function cloneStyle() {\n            copyStyle(window.getComputedStyle(original), clone.style);\n\n            function copyStyle(source, target) {\n                if (source.cssText) target.cssText = source.cssText;\n                else copyProperties(source, target);\n\n                function copyProperties(source, target) {\n                    util.asArray(source).forEach(function(name) {\n                        target.setProperty(\n                            name,\n                            source.getPropertyValue(name),\n                            source.getPropertyPriority(name)\n                        );\n                    });\n                }\n            }\n        }\n\n        function clonePseudoElements() {\n            [\":before\", \":after\"].forEach(function(element) {\n                clonePseudoElement(element);\n            });\n\n            function clonePseudoElement(element) {\n                var style = window.getComputedStyle(original, element);\n                var content = style.getPropertyValue(\"content\");\n\n                if (content === \"\" || content === \"none\") return;\n\n                var className = util.uid();\n                clone.className = clone.className + \" \" + className;\n                var styleElement = document.createElement(\"style\");\n                styleElement.appendChild(formatPseudoElementStyle(className, element, style));\n                clone.appendChild(styleElement);\n\n                function formatPseudoElementStyle(className, element, style) {\n                    var selector = \".\" + className + \":\" + element;\n                    var cssText = style.cssText ? formatCssText(style) : formatCssProperties(style);\n                    return document.createTextNode(selector + \"{\" + cssText + \"}\");\n\n                    function formatCssText(style) {\n                        var content = style.getPropertyValue(\"content\");\n                        return style.cssText + \" content: \" + content + \";\";\n                    }\n\n                    function formatCssProperties(style) {\n                        return (\n                            util\n                                .asArray(style)\n                                .map(formatProperty)\n                                .join(\"; \") + \";\"\n                        );\n\n                        function formatProperty(name) {\n                            return (\n                                name +\n                                \": \" +\n                                style.getPropertyValue(name) +\n                                (style.getPropertyPriority(name) ? \" !important\" : \"\")\n                            );\n                        }\n                    }\n                }\n            }\n        }\n\n        function copyUserInput() {\n            if (original instanceof HTMLTextAreaElement) clone.innerHTML = original.value;\n            if (original instanceof HTMLInputElement) clone.setAttribute(\"value\", original.value);\n        }\n\n        function fixSvg() {\n            if (!(clone instanceof SVGElement)) return;\n            clone.setAttribute(\"xmlns\", \"http://www.w3.org/2000/svg\");\n\n            if (!(clone instanceof SVGRectElement)) return;\n            [\"width\", \"height\"].forEach(function(attribute) {\n                var value = clone.getAttribute(attribute);\n                if (!value) return;\n\n                clone.style.setProperty(attribute, value);\n            });\n        }\n    }\n}\n\nfunction embedFonts(node) {\n    return fontFaces.resolveAll().then(function(cssText) {\n        const styleNode = document.createElement(\"style\");\n        node.appendChild(styleNode);\n        styleNode.appendChild(document.createTextNode(cssText));\n        return node;\n    });\n}\n\nfunction inlineImages(node) {\n    return images.inlineAll(node).then(function() {\n        return node;\n    });\n}\n\nfunction makeSvgDataUri(node, width, height) {\n    return Promise.resolve(node)\n        .then(function(node) {\n            node.setAttribute(\"xmlns\", \"http://www.w3.org/1999/xhtml\");\n            return new XMLSerializer().serializeToString(node);\n        })\n        .then(util.escapeXhtml)\n        .then(function(xhtml) {\n            return (\n                '<foreignObject x=\"0\" y=\"0\" width=\"100%\" height=\"100%\">' +\n                xhtml +\n                \"</foreignObject>\"\n            );\n        })\n        .then(function(foreignObject) {\n            return (\n                '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"' +\n                width +\n                '\" height=\"' +\n                height +\n                '\">' +\n                foreignObject +\n                \"</svg>\"\n            );\n        })\n        .then(function(svg) {\n            return \"data:image/svg+xml;charset=utf-8,\" + svg;\n        });\n}\n\nfunction newUtil() {\n    return {\n        escape,\n        mimeType,\n        dataAsUrl,\n        isDataUrl,\n        resolveUrl,\n        getAndEncode,\n        uid: uid(),\n        delay,\n        asArray,\n        escapeXhtml,\n        makeImage,\n        width,\n        height\n    };\n\n    function mimes() {\n        /*\n         * Only WOFF and EOT mime types for fonts are 'real'\n         * see http://www.iana.org/assignments/media-types/media-types.xhtml\n         */\n        const WOFF = \"application/font-woff\";\n        const JPEG = \"image/jpeg\";\n\n        return {\n            woff: WOFF,\n            woff2: WOFF,\n            ttf: \"application/font-truetype\",\n            eot: \"application/vnd.ms-fontobject\",\n            png: \"image/png\",\n            jpg: JPEG,\n            jpeg: JPEG,\n            gif: \"image/gif\",\n            tiff: \"image/tiff\",\n            svg: \"image/svg+xml\"\n        };\n    }\n\n    function parseExtension(url) {\n        const match = /\\.([^\\.\\/]*?)$/g.exec(url);\n        return match ? match[1] : \"\";\n    }\n\n    function mimeType(url) {\n        const extension = parseExtension(url)\n            .toLowerCase()\n            .split(\"?\")[0];\n        return mimes()[extension] || \"\";\n    }\n\n    function isDataUrl(url) {\n        return url.search(/^(data:)/) !== -1;\n    }\n\n    function toBlob(canvas) {\n        return new Promise(function(resolve) {\n            var binaryString = window.atob(canvas.toDataURL().split(\",\")[1]);\n            var length = binaryString.length;\n            var binaryArray = new Uint8Array(length);\n\n            for (var i = 0; i < length; i++) binaryArray[i] = binaryString.charCodeAt(i);\n\n            resolve(\n                new Blob([binaryArray], {\n                    type: \"image/png\"\n                })\n            );\n        });\n    }\n\n    function canvasToBlob(canvas) {\n        if (canvas.toBlob)\n            return new Promise(function(resolve) {\n                canvas.toBlob(resolve);\n            });\n\n        return toBlob(canvas);\n    }\n\n    function resolveUrl(url, baseUrl) {\n        const doc = document.implementation.createHTMLDocument();\n        const base = doc.createElement(\"base\");\n        doc.head.appendChild(base);\n        const a = doc.createElement(\"a\");\n        doc.body.appendChild(a);\n        base.href = baseUrl;\n        a.href = url;\n        return a.href;\n    }\n\n    function uid() {\n        let index = 0;\n\n        return function() {\n            return \"u\" + fourRandomChars() + index++;\n\n            function fourRandomChars() {\n                /* see http://stackoverflow.com/a/6248722/2519373 */\n                return (\"0000\" + ((Math.random() * Math.pow(36, 4)) << 0).toString(36)).slice(-4);\n            }\n        };\n    }\n\n    function makeImage(uri) {\n        return new Promise(function(resolve, reject) {\n            var image = new Image();\n            image.onload = function() {\n                resolve(image);\n            };\n            image.onerror = reject;\n            image.src = uri;\n        });\n    }\n\n    function getAndEncode(url) {\n        var TIMEOUT = 30000;\n        if (domtoimage.impl.options.cacheBust) {\n            // Cache bypass so we dont have CORS issues with cached images\n            // Source: https://developer.mozilla.org/en/docs/Web/API/XMLHttpRequest/Using_XMLHttpRequest#Bypassing_the_cache\n            url += (/\\?/.test(url) ? \"&\" : \"?\") + new Date().getTime();\n        }\n\n        return new Promise(function(resolve) {\n            var request = new XMLHttpRequest();\n\n            request.onreadystatechange = done;\n            request.ontimeout = timeout;\n            request.responseType = \"blob\";\n            request.timeout = TIMEOUT;\n            request.open(\"GET\", url, true);\n            request.send();\n\n            var placeholder;\n            if (domtoimage.impl.options.imagePlaceholder) {\n                var split = domtoimage.impl.options.imagePlaceholder.split(/,/);\n                if (split && split[1]) {\n                    placeholder = split[1];\n                }\n            }\n\n            function done() {\n                if (request.readyState !== 4) return;\n\n                if (request.status !== 200) {\n                    if (placeholder) {\n                        resolve(placeholder);\n                    } else {\n                        fail(\"cannot fetch resource: \" + url + \", status: \" + request.status);\n                    }\n\n                    return;\n                }\n\n                var encoder = new FileReader();\n                encoder.onloadend = function() {\n                    var content = encoder.result.split(/,/)[1];\n                    resolve(content);\n                };\n                encoder.readAsDataURL(request.response);\n            }\n\n            function timeout() {\n                if (placeholder) {\n                    resolve(placeholder);\n                } else {\n                    fail(\"timeout of \" + TIMEOUT + \"ms occured while fetching resource: \" + url);\n                }\n            }\n\n            function fail(message) {\n                console.error(message);\n                resolve(\"\");\n            }\n        });\n    }\n\n    function dataAsUrl(content, type) {\n        return \"data:\" + type + \";base64,\" + content;\n    }\n\n    function escape(string) {\n        return string.replace(/([.*+?^${}()|\\[\\]\\/\\\\])/g, \"\\\\$1\");\n    }\n\n    function delay(ms) {\n        return function(arg) {\n            return new Promise(function(resolve) {\n                setTimeout(function() {\n                    resolve(arg);\n                }, ms);\n            });\n        };\n    }\n\n    function asArray(arrayLike) {\n        const array = [];\n        const length = arrayLike.length;\n        for (var i = 0; i < length; i++) array.push(arrayLike[i]);\n        return array;\n    }\n\n    function escapeXhtml(string) {\n        return string.replace(/#/g, \"%23\").replace(/\\n/g, \"%0A\");\n    }\n\n    function width(node) {\n        const leftBorder = px(node, \"border-left-width\");\n        const rightBorder = px(node, \"border-right-width\");\n        return node.scrollWidth + leftBorder + rightBorder;\n    }\n\n    function height(node) {\n        var topBorder = px(node, \"border-top-width\");\n        var bottomBorder = px(node, \"border-bottom-width\");\n        return node.scrollHeight + topBorder + bottomBorder;\n    }\n\n    function px(node, styleProperty) {\n        var value = window.getComputedStyle(node).getPropertyValue(styleProperty);\n        return parseFloat(value.replace(\"px\", \"\"));\n    }\n}\n\nfunction newInliner() {\n    const URL_REGEX = /url\\(['\"]?([^'\"]+?)['\"]?\\)/g;\n\n    return {\n        inlineAll,\n        shouldProcess,\n        impl: { readUrls, inline }\n    };\n\n    function shouldProcess(string) {\n        return string.search(URL_REGEX) !== -1;\n    }\n\n    function readUrls(string) {\n        var result = [];\n        var match;\n        while ((match = URL_REGEX.exec(string)) !== null) {\n            result.push(match[1]);\n        }\n        return result.filter(function(url) {\n            return !util.isDataUrl(url);\n        });\n    }\n\n    function inline(string, url, baseUrl, get) {\n        return Promise.resolve(url)\n            .then(function(url) {\n                return baseUrl ? util.resolveUrl(url, baseUrl) : url;\n            })\n            .then(get || util.getAndEncode)\n            .then(function(data) {\n                return util.dataAsUrl(data, util.mimeType(url));\n            })\n            .then(function(dataUrl) {\n                return string.replace(urlAsRegex(url), \"$1\" + dataUrl + \"$3\");\n            });\n\n        function urlAsRegex(url) {\n            return new RegExp(\"(url\\\\(['\\\"]?)(\" + util.escape(url) + \")(['\\\"]?\\\\))\", \"g\");\n        }\n    }\n\n    function inlineAll(string, baseUrl, get) {\n        if (nothingToInline()) return Promise.resolve(string);\n\n        return Promise.resolve(string)\n            .then(readUrls)\n            .then(function(urls) {\n                var done = Promise.resolve(string);\n                urls.forEach(function(url) {\n                    done = done.then(function(string) {\n                        return inline(string, url, baseUrl, get);\n                    });\n                });\n                return done;\n            });\n\n        function nothingToInline() {\n            return !shouldProcess(string);\n        }\n    }\n}\n\nfunction newFontFaces() {\n    return {\n        resolveAll: resolveAll,\n        impl: {\n            readAll: readAll\n        }\n    };\n\n    function resolveAll() {\n        return readAll(document)\n            .then(function(webFonts) {\n                return Promise.all(\n                    webFonts.map(function(webFont) {\n                        return webFont.resolve();\n                    })\n                );\n            })\n            .then(function(cssStrings) {\n                return cssStrings.join(\"\\n\");\n            });\n    }\n\n    function readAll() {\n        return Promise.resolve(util.asArray(document.styleSheets))\n            .then(getCssRules)\n            .then(selectWebFontRules)\n            .then(function(rules) {\n                return rules.map(newWebFont);\n            });\n\n        function selectWebFontRules(cssRules) {\n            return cssRules\n                .filter(function(rule) {\n                    return rule.type === CSSRule.FONT_FACE_RULE;\n                })\n                .filter(function(rule) {\n                    return inliner.shouldProcess(rule.style.getPropertyValue(\"src\"));\n                });\n        }\n\n        function getCssRules(styleSheets) {\n            var cssRules = [];\n            styleSheets.forEach(function(sheet) {\n                if (sheet.hasOwnProperty(\"cssRules\")) {\n                    try {\n                        util.asArray(sheet.cssRules || []).forEach(cssRules.push.bind(cssRules));\n                    } catch (e) {\n                        console.log(\n                            \"Error while reading CSS rules from \" + sheet.href,\n                            e.toString()\n                        );\n                    }\n                }\n            });\n            return cssRules;\n        }\n\n        function newWebFont(webFontRule) {\n            return {\n                resolve: function resolve() {\n                    var baseUrl = (webFontRule.parentStyleSheet || {}).href;\n                    return inliner.inlineAll(webFontRule.cssText, baseUrl);\n                },\n                src: function() {\n                    return webFontRule.style.getPropertyValue(\"src\");\n                }\n            };\n        }\n    }\n}\n\nfunction newImages() {\n    return {\n        inlineAll: inlineAll,\n        impl: { newImage }\n    };\n\n    function newImage(element) {\n        return {\n            inline: inline\n        };\n\n        function inline(get) {\n            if (util.isDataUrl(element.src)) return Promise.resolve();\n\n            return Promise.resolve(element.src)\n                .then(get || util.getAndEncode)\n                .then(function(data) {\n                    return util.dataAsUrl(data, util.mimeType(element.src));\n                })\n                .then(function(dataUrl) {\n                    element.removeAttribute(\"srcset\");\n\n                    return new Promise(function(resolve, reject) {\n                        element.onload = resolve;\n                        element.onerror = reject;\n                        element.src = dataUrl;\n                    });\n                });\n        }\n    }\n\n    function inlineAll(node) {\n        if (!(node instanceof Element)) return Promise.resolve(node);\n\n        return inlineBackground(node).then(function() {\n            if (node instanceof HTMLImageElement) return newImage(node).inline();\n            else\n                return Promise.all(\n                    util.asArray(node.childNodes).map(function(child) {\n                        return inlineAll(child);\n                    })\n                );\n        });\n\n        function inlineBackground(node) {\n            var background = node.style.getPropertyValue(\"background\");\n\n            if (!background) return Promise.resolve(node);\n\n            return inliner\n                .inlineAll(background)\n                .then(function(inlined) {\n                    node.style.setProperty(\n                        \"background\",\n                        inlined,\n                        node.style.getPropertyPriority(\"background\")\n                    );\n                })\n                .then(function() {\n                    return node;\n                });\n        }\n    }\n}\n"],"file":"domToImage.js"}