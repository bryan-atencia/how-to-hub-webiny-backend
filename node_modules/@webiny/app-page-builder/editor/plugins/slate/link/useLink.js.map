{"version":3,"sources":["../../../../../src/editor/plugins/slate/link/useLink.ts"],"names":["useEffect","useCallback","useRef","getLinkRange","TYPE","getSelectionRect","native","window","getSelection","type","top","left","width","height","range","getRangeAt","getBoundingClientRect","useLink","editor","onChange","activatePlugin","menuRef","link","value","inlines","find","inline","selection","menu","current","isFocused","style","display","editorRect","parentNode","cursorLeft","position","menuRect","activateLink","removeLink","change","select","unwrapInline","href","data","get"],"mappings":"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","sourcesContent":["import { useEffect, useCallback, useRef } from \"react\";\nimport { getLinkRange, TYPE } from \"./utils\";\n\nconst getSelectionRect = () => {\n    const native = window.getSelection();\n    if (native.type === \"None\") {\n        return { top: 0, left: 0, width: 0, height: 0 };\n    }\n\n    const range = native.getRangeAt(0);\n    return range.getBoundingClientRect();\n};\n\nexport default function useLink({ editor, onChange, activatePlugin }) {\n    const menuRef = useRef(null);\n    const link = editor.value.inlines.find(inline => inline.type === \"link\");\n    const { selection } = editor.value;\n\n    useEffect(() => {\n        const menu = menuRef.current;\n\n        if (!link && selection.isFocused) {\n            menu.style.display = \"none\";\n            return;\n        }\n\n        if (!selection.isFocused) {\n            // Don't reposition the tooltip;\n            // When we attempt to click the button, editor focus is lost.\n            return;\n        }\n\n        // Calculate position\n        if (menu) {\n            const editorRect = menu.parentNode.getBoundingClientRect();\n            const { top, left, height } = getSelectionRect();\n\n            // Cursor position is calculated in relation to `window`\n            const cursorLeft = left - editorRect.left;\n            const position = { top: top - editorRect.top + height, left: cursorLeft };\n\n            menu.style.display = \"flex\";\n            menu.style.top = position.top + \"px\";\n            menu.style.left = `0px`;\n\n            // Menu position is calculated in relation to parent element\n            const menuRect = menu.getBoundingClientRect();\n            if (menuRect.width + cursorLeft > editorRect.width) {\n                menu.style.left = `${editorRect.width - menuRect.width - 20}px`;\n            } else {\n                menu.style.left = `${cursorLeft}px`;\n            }\n        }\n    });\n\n    function activateLink() {\n        activatePlugin(\"pb-editor-slate-menu-item-link\");\n    }\n\n    const removeLink = useCallback(() => {\n        const menu = menuRef.current;\n        editor.change(change => {\n            // Restore selection\n            change.select(getLinkRange(change, change.value.selection)).unwrapInline(TYPE);\n            onChange(change);\n            menu.style.display = \"none\";\n        });\n    }, []);\n\n    const href = link ? link.data.get(\"href\") : \"\";\n\n    return {\n        href,\n        menuRef,\n        activateLink,\n        removeLink\n    };\n}\n"],"file":"useLink.js"}