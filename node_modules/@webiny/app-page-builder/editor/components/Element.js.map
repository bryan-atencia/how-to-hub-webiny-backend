{"version":3,"sources":["../../../src/editor/components/Element.tsx"],"names":["React","Transition","isEqual","connect","useHandler","getPlugins","renderPlugins","dragStart","dragEnd","activateElement","highlightElement","getElementProps","getElement","Draggable","defaultStyle","ElementContainer","transitionStyles","typeStyle","tryRenderingPlugin","getElementPlugin","element","plugins","find","pl","elementType","type","Element","props","highlight","active","className","plugin","beginDrag","data","id","path","setTimeout","target","endDrag","useCallback","monitor","getItem","onClick","onMouseOver","e","stopPropagation","renderDraggable","drag","renderedPlugin","render","state","filter","c","join","areStatePropsEqual","memo"],"mappings":"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","sourcesContent":["import * as React from \"react\";\nimport { Transition } from \"react-transition-group\";\nimport isEqual from \"lodash/isEqual\";\nimport { connect } from \"@webiny/app-page-builder/editor/redux\";\nimport { useHandler } from \"@webiny/app/hooks/useHandler\";\nimport { getPlugins } from \"@webiny/plugins\";\nimport { renderPlugins } from \"@webiny/app/plugins\";\nimport {\n    dragStart,\n    dragEnd,\n    activateElement,\n    highlightElement\n} from \"@webiny/app-page-builder/editor/actions\";\nimport { getElementProps, getElement } from \"@webiny/app-page-builder/editor/selectors\";\nimport Draggable from \"./Draggable\";\nimport { PbElement, PbEditorPageElementPlugin } from \"@webiny/app-page-builder/types\";\nimport {\n    defaultStyle,\n    ElementContainer,\n    transitionStyles,\n    typeStyle\n} from \"./Element/ElementStyled\";\nimport tryRenderingPlugin from \"./../../utils/tryRenderingPlugin\";\n\nexport type ElementProps = {\n    className?: string;\n    active: boolean;\n    dragStart: Function;\n    dragEnd: Function;\n    element: PbElement;\n    highlight: boolean;\n    onClick: Function;\n    onMouseOver: Function;\n    renderDraggable: Function;\n    beginDrag: Function;\n    endDrag: Function;\n    dragging: boolean;\n};\n\nconst getElementPlugin = (element): PbEditorPageElementPlugin => {\n    if (!element) {\n        return null;\n    }\n\n    const plugins = getPlugins<PbEditorPageElementPlugin>(\"pb-editor-page-element\");\n    return plugins.find(pl => pl.elementType === element.type);\n};\n\nconst Element = (props: ElementProps) => {\n    const { dragEnd, element, highlight, active, className = \"\" } = props;\n    const plugin = getElementPlugin(element);\n\n    const beginDrag = useHandler(props, ({ dragStart, element }) => () => {\n        const data = { id: element.id, type: element.type, path: element.path };\n        setTimeout(() => {\n            dragStart({ element: data });\n        });\n        return { ...data, target: plugin.target };\n    });\n\n    const endDrag = React.useCallback(\n        (props, monitor) => {\n            dragEnd({ element: monitor.getItem() });\n        },\n        [dragEnd]\n    );\n\n    const onClick = useHandler(props, ({ element, active, activateElement }) => () => {\n        if (element.type === \"document\") {\n            return;\n        }\n        if (!active) {\n            activateElement({ element: element.id });\n        }\n    });\n\n    const onMouseOver = useHandler(props, ({ element, highlight, highlightElement }) => e => {\n        if (element.type === \"document\") {\n            return;\n        }\n\n        e.stopPropagation();\n        if (!highlight) {\n            highlightElement({ element: element.id });\n        }\n    });\n\n    const renderDraggable = useHandler(props, ({ element }) => ({ drag }) => {\n        return (\n            <div ref={drag} className={\"type \" + typeStyle}>\n                <div className=\"background\" onClick={onClick} />\n                <div className={\"element-holder\"} onClick={onClick}>\n                    {renderPlugins(\"pb-editor-page-element-action\", { element, plugin })}\n                    <span>{plugin.elementType}</span>\n                </div>\n            </div>\n        );\n    });\n\n    if (!plugin) {\n        return null;\n    }\n\n    const renderedPlugin = tryRenderingPlugin(() => plugin.render({ element }));\n\n    return (\n        <Transition in={true} timeout={250} appear={true}>\n            {state => (\n                <ElementContainer\n                    id={element.id}\n                    onMouseOver={onMouseOver}\n                    highlight={highlight}\n                    active={active}\n                    style={{ ...defaultStyle, ...transitionStyles[state] }}\n                    className={\"webiny-pb-page-element-container\"}\n                >\n                    <div className={[\"innerWrapper\", className].filter(c => c).join(\" \")}>\n                        <Draggable target={plugin.target} beginDrag={beginDrag} endDrag={endDrag}>\n                            {renderDraggable}\n                        </Draggable>\n                        {renderedPlugin}\n                    </div>\n                    {/*\n                        <div className=\"add-element add-element--above\">+</div>\n                        <div className=\"add-element add-element--below\">+</div>\n                        */}\n                </ElementContainer>\n            )}\n        </Transition>\n    );\n};\n\nexport default connect<any, any, any>(\n    (state, props) => {\n        return {\n            ...getElementProps(state, props),\n            element: getElement(state, props.id)\n        };\n    },\n    { dragStart, dragEnd, activateElement, highlightElement },\n    null,\n    { areStatePropsEqual: isEqual }\n)(React.memo(Element));\n"],"file":"Element.js"}