{"version":3,"sources":["../../../../src/editor/components/Editor/Toolbar.tsx"],"names":["React","useEffect","useRef","connect","styled","css","Drawer","DrawerContent","getPlugins","useKeyHandler","deactivatePlugin","getActivePlugins","ToolbarDrawerContainer","top","left","position","backgroundColor","zIndex","ToolbarContainer","display","padding","width","height","boxShadow","DrawerContainer","open","pointerEvents","ToolbarActions","flexDirection","justifyContent","drawerStyle","marginLeft","maxWidth","ToolbarDrawer","name","active","children","removeKeyHandler","addKeyHandler","last","current","e","preventDefault","renderPlugin","plugin","cloneElement","renderAction","key","Toolbar","activePluginsTop","actionsTop","actionsBottom","filter","renderDrawer","map","Boolean","includes","state","pl","activePluginsBottom","areStatePropsEqual"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef } from \"react\";\nimport { connect } from \"@webiny/app-page-builder/editor/redux\";\nimport styled from \"@emotion/styled\";\nimport { css } from \"emotion\";\nimport { isEqual } from \"lodash\";\nimport { Drawer, DrawerContent } from \"@webiny/ui/Drawer\";\nimport { getPlugins } from \"@webiny/plugins\";\nimport { useKeyHandler } from \"@webiny/app-page-builder/editor/hooks/useKeyHandler\";\nimport { deactivatePlugin } from \"@webiny/app-page-builder/editor/actions\";\nimport { getActivePlugins } from \"@webiny/app-page-builder/editor/selectors\";\nimport {\n    PbEditorToolbarBottomPlugin,\n    PbEditorToolbarTopPlugin\n} from \"@webiny/app-page-builder/types\";\n\nconst ToolbarDrawerContainer = styled(\"div\")({\n    top: 64,\n    left: 0,\n    position: \"fixed\",\n    backgroundColor: \"var(--mdc-theme-surface)\",\n    zIndex: 2\n});\n\nconst ToolbarContainer = styled(\"div\")({\n    position: \"fixed\",\n    display: \"inline-block\",\n    padding: \"2px 1px 2px 3px\",\n    width: 50,\n    top: 64,\n    height: \"calc(100vh - 68px)\",\n    backgroundColor: \"var(--mdc-theme-surface)\",\n    boxShadow: \"1px 0px 5px 0px var(--mdc-theme-on-background)\",\n    zIndex: 3\n});\n\nconst DrawerContainer = styled(\"div\")(({ open }: any) => ({\n    pointerEvents: open ? \"all\" : \"none\",\n    \".mdc-drawer__drawer\": {\n        \"> .mdc-list\": {\n            padding: 0\n        }\n    }\n}));\n\nconst ToolbarActions = styled(\"div\")({\n    position: \"relative\",\n    display: \"flex\",\n    flexDirection: \"column\",\n    justifyContent: \"space-between\",\n    height: \"100%\"\n});\n\nconst drawerStyle = css({\n    zIndex: 10,\n    \"&.mdc-drawer--dismissible\": {\n        marginLeft: 54,\n        position: \"fixed\",\n        top: 64,\n        width: \"490px !important\",\n        maxWidth: \"490px !important\",\n        \".mdc-drawer__content\": {\n            width: \"100%\"\n        }\n    }\n});\n\nconst ToolbarDrawer = connect<any, any, any>(null, { deactivatePlugin })(\n    ({ name, active, children, deactivatePlugin }: any) => {\n        const { removeKeyHandler, addKeyHandler } = useKeyHandler();\n        const last = useRef({ active: null });\n        useEffect(() => {\n            if (active && !last.current.active) {\n                addKeyHandler(\"escape\", e => {\n                    e.preventDefault();\n                    deactivatePlugin({ name });\n                });\n            }\n\n            if (!active && last.current.active) {\n                removeKeyHandler(\"escape\");\n            }\n        });\n\n        useEffect(() => {\n            last.current = { active };\n        });\n\n        return (\n            <DrawerContainer open={active}>\n                <Drawer dismissible open={active} className={drawerStyle}>\n                    <DrawerContent>{children}</DrawerContent>\n                </Drawer>\n            </DrawerContainer>\n        );\n    }\n);\n\nconst renderPlugin = (plugin: PbEditorToolbarTopPlugin | PbEditorToolbarBottomPlugin) => {\n    return React.cloneElement(plugin.renderAction(), { key: plugin.name });\n};\n\nconst Toolbar = ({ activePluginsTop }) => {\n    const actionsTop = getPlugins<PbEditorToolbarTopPlugin>(\"pb-editor-toolbar-top\");\n    const actionsBottom = getPlugins<PbEditorToolbarBottomPlugin>(\"pb-editor-toolbar-bottom\");\n\n    return (\n        <React.Fragment>\n            <ToolbarDrawerContainer>\n                {actionsTop\n                    .filter(plugin => typeof plugin.renderDrawer === \"function\")\n                    .map(plugin => (\n                        <ToolbarDrawer\n                            key={plugin.name}\n                            name={plugin.name}\n                            active={Boolean(activePluginsTop.includes(plugin.name))}\n                        >\n                            {plugin.renderDrawer()}\n                        </ToolbarDrawer>\n                    ))}\n            </ToolbarDrawerContainer>\n            <ToolbarContainer>\n                <ToolbarActions>\n                    <div>{actionsTop.map(renderPlugin)}</div>\n                    <div>{actionsBottom.map(renderPlugin)}</div>\n                </ToolbarActions>\n            </ToolbarContainer>\n        </React.Fragment>\n    );\n};\n\nexport default connect<any, any, any>(\n    state => ({\n        activePluginsTop: getActivePlugins(\"pb-editor-toolbar-top\")(state).map(pl => pl.name),\n        activePluginsBottom: getActivePlugins(\"pb-editor-toolbar-bottom\")(state).map(pl => pl.name)\n    }),\n    null,\n    null,\n    { areStatePropsEqual: isEqual }\n)(Toolbar);\n"],"file":"Toolbar.js"}