{"version":3,"sources":["../../src/plugins/install.tsx"],"names":["React","useState","useEffect","gql","useApolloClient","i18n","Alert","CircularProgress","SimpleForm","SimpleFormContent","styled","SimpleFormPlaceholder","minHeight","minWidth","t","ns","IS_INSTALLED","INSTALL","FMInstaller","onInstalled","client","error","setError","mutate","mutation","variables","srcPrefix","process","env","REACT_APP_API_URL","then","data","files","install","message","setTimeout","plugin","name","type","title","dependencies","secure","isInstalled","query","render"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport gql from \"graphql-tag\";\nimport { useApolloClient } from \"react-apollo\";\nimport { i18n } from \"@webiny/app/i18n\";\nimport { AdminInstallationPlugin } from \"@webiny/app-admin/types\";\nimport { Alert } from \"@webiny/ui/Alert\";\nimport { CircularProgress } from \"@webiny/ui/Progress\";\nimport { SimpleForm, SimpleFormContent } from \"@webiny/app-admin/components/SimpleForm\";\nimport styled from \"@emotion/styled\";\n\nconst SimpleFormPlaceholder = styled.div({\n    minHeight: 300,\n    minWidth: 400\n});\n\nconst t = i18n.ns(\"app-admin/admin/installation\");\n\nconst IS_INSTALLED = gql`\n    {\n        files {\n            isInstalled {\n                data\n                error {\n                    code\n                    message\n                }\n            }\n        }\n    }\n`;\n\nconst INSTALL = gql`\n    mutation InstallFileManager($srcPrefix: String) {\n        files {\n            install(srcPrefix: $srcPrefix) {\n                data\n                error {\n                    code\n                    message\n                }\n            }\n        }\n    }\n`;\n\nconst FMInstaller = ({ onInstalled }) => {\n    const client = useApolloClient();\n    const [error, setError] = useState(null);\n\n    useEffect(() => {\n        client\n            .mutate({\n                mutation: INSTALL,\n                variables: { srcPrefix: process.env.REACT_APP_API_URL + \"/files\" }\n            })\n            .then(({ data }) => {\n                const { error } = data.files.install;\n                if (error) {\n                    setError(error.message);\n                    return;\n                }\n\n                // Just so the user sees the actual message.\n                setTimeout(onInstalled, 3000);\n            });\n    }, []);\n\n    return (\n        <SimpleForm>\n            <CircularProgress label={t`Installing File Manager...`} />\n            {error && (\n                <Alert title={t`Something went wrong`} type={\"danger\"}>\n                    {error}\n                </Alert>\n            )}\n            <SimpleFormContent>\n                <SimpleFormPlaceholder />\n            </SimpleFormContent>\n        </SimpleForm>\n    );\n};\n\nconst plugin: AdminInstallationPlugin = {\n    name: \"installation-fm\",\n    type: \"admin-installation\",\n    title: t`File Manager app`,\n    dependencies: [\"installation-security\"],\n    secure: true,\n    async isInstalled({ client }) {\n        const { data } = await client.query({ query: IS_INSTALLED });\n        return data.files.isInstalled.data;\n    },\n    render({ onInstalled }) {\n        return <FMInstaller onInstalled={onInstalled} />;\n    }\n};\n\nexport default plugin;\n"],"file":"install.js"}