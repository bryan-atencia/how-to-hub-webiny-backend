{"version":3,"sources":["../../../../src/plugins/FileManager/fileImage/EditAction.tsx"],"names":["React","Hotkeys","dataURLtoBlob","ImageEditorDialog","Tooltip","IconButton","outputFileSelectionError","useSnackbar","toDataUrl","url","Promise","resolve","xhr","window","XMLHttpRequest","onload","reader","FileReader","onloadend","result","readAsDataURL","response","open","responseType","send","initialState","showImageEditor","dataUrl","reducer","state","action","next","type","EditAction","props","file","uploadFile","validateFiles","useReducer","dispatch","showSnackbar","margin","src","blob","errors","length","name"],"mappings":"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","sourcesContent":["import * as React from \"react\";\nimport { Hotkeys } from \"react-hotkeyz\";\nimport dataURLtoBlob from \"dataurl-to-blob\";\nimport { ImageEditorDialog } from \"@webiny/ui/ImageUpload\";\nimport { Tooltip } from \"@webiny/ui/Tooltip\";\nimport { IconButton } from \"@webiny/ui/Button\";\nimport outputFileSelectionError from \"@webiny/app-admin/components/FileManager/outputFileSelectionError\";\nimport { useSnackbar } from \"@webiny/app-admin/hooks/useSnackbar\";\nimport { ReactComponent as EditIcon } from \"./../icons/edit.svg\";\n\nfunction toDataUrl(url) {\n    return new Promise(resolve => {\n        const xhr = new window.XMLHttpRequest();\n        xhr.onload = function() {\n            const reader = new window.FileReader();\n            reader.onloadend = function() {\n                resolve(reader.result);\n            };\n            reader.readAsDataURL(xhr.response);\n        };\n        xhr.open(\"GET\", url);\n        xhr.responseType = \"blob\";\n        xhr.send();\n    });\n}\n\nconst initialState = { showImageEditor: false, dataUrl: null };\nconst reducer = (state, action) => {\n    const next = { ...state };\n\n    switch (action.type) {\n        case \"setDataUrl\":\n            next.dataUrl = action.dataUrl;\n            next.showImageEditor = true;\n            break;\n        case \"hideImageEditor\":\n            next.dataUrl = null;\n            next.showImageEditor = false;\n            break;\n    }\n\n    return next;\n};\n\n// TODO: @adrian\ntype EditActionProps = {\n    file: any;\n    uploadFile: any;\n    validateFiles: any;\n};\n\nconst EditAction: React.FC<EditActionProps> = props => {\n    const { file, uploadFile, validateFiles } = props;\n    const [state, dispatch] = React.useReducer(reducer, initialState);\n    const { showSnackbar } = useSnackbar();\n\n    return (\n        <>\n            <Tooltip content={<span>Edit image</span>} placement={\"bottom\"}>\n                <IconButton\n                    icon={<EditIcon style={{ margin: \"0 8px 0 0\" }} />}\n                    onClick={async () => {\n                        dispatch({ type: \"setDataUrl\", dataUrl: await toDataUrl(file.src) });\n                    }}\n                />\n            </Tooltip>\n            <Hotkeys zIndex={60} disabled={!state.dataUrl}>\n                <ImageEditorDialog\n                    dialogZIndex={10}\n                    open={state.showImageEditor}\n                    src={state.dataUrl}\n                    onClose={() => dispatch({ type: \"hideImageEditor\" })}\n                    onAccept={src => {\n                        const blob = dataURLtoBlob(src);\n                        const errors = validateFiles([blob]);\n\n                        if (errors.length) {\n                            showSnackbar(outputFileSelectionError(errors));\n                        } else {\n                            blob.name = file.name;\n                            uploadFile(blob);\n                        }\n\n                        dispatch({ type: \"hideImageEditor\" });\n                    }}\n                />\n            </Hotkeys>\n        </>\n    );\n};\n\nexport default EditAction;\n"],"file":"EditAction.js"}