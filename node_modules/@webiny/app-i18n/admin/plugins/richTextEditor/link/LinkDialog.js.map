{"version":3,"sources":["../../../../../src/admin/plugins/richTextEditor/link/LinkDialog.tsx"],"names":["React","Fragment","useHandler","Form","Input","Switch","Cell","Grid","Dialog","DialogContent","DialogTitle","DialogCancel","DialogActions","DialogButton","validation","Editor","Transforms","Range","ReactEditor","getLink","editor","nodes","match","n","type","item","createLink","data","children","LinkDialog","props","open","closeDialog","activePlugin","linkData","select","selection","Array","isArray","link","path","selectedText","anchor","start","focus","end","text","fragment","updateLink","isCollapsed","existingLink","findPath","setNodes","at","insertText","insertNodes","wrapNodes","split","collapse","edge","deselect","formData","zIndex","Bind","submit","create"],"mappings":";;;AAAA,OAAOA,KAAP,IAAgBC,QAAhB,QAAgC,OAAhC;AACA,SAASC,UAAT,QAA2B,8BAA3B;AACA,SAASC,IAAT,QAAqB,cAArB;AACA,SAASC,KAAT,QAAsB,kBAAtB;AACA,SAASC,MAAT,QAAuB,mBAAvB;AACA,SAASC,IAAT,EAAeC,IAAf,QAA2B,iBAA3B;AACA,SACIC,MADJ,EAEIC,aAFJ,EAGIC,WAHJ,EAIIC,YAJJ,EAKIC,aALJ,EAMIC,YANJ,QAOO,mBAPP;AAQA,SAASC,UAAT,QAA2B,oBAA3B;AACA,SAASC,MAAT,EAAiBC,UAAjB,EAA6BC,KAA7B,QAA0C,OAA1C;AACA,SAASC,WAAT,QAA4B,aAA5B;;AAEA,IAAMC,OAAO,GAAG,SAAVA,OAAU,CAAAC,MAAM,EAAI;AAAA,sBACPL,MAAM,CAACM,KAAP,CAAaD,MAAb,EAAqB;AAAEE,IAAAA,KAAK,EAAE,eAAAC,CAAC;AAAA,aAAIA,CAAC,CAACC,IAAF,KAAW,MAAf;AAAA;AAAV,GAArB,CADO;AAAA;AAAA,MACfC,IADe;;AAEtB,SAAOA,IAAP;AACH,CAHD;;AAKA,IAAMC,UAAU,GAAG,SAAbA,UAAa,CAACC,IAAD,EAAOC,QAAP,EAAoB;AACnC;AACIJ,IAAAA,IAAI,EAAE;AADV,KAEOG,IAFP;AAGIC,IAAAA,QAAQ,EAARA;AAHJ;AAKH,CAND;;AAQA,OAAO,IAAMC,UAAU,GAAG,SAAbA,UAAa,CAAAC,KAAK,EAAI;AAAA,MACvBV,MADuB,GACqBU,KADrB,CACvBV,MADuB;AAAA,MACfW,IADe,GACqBD,KADrB,CACfC,IADe;AAAA,MACTC,WADS,GACqBF,KADrB,CACTE,WADS;AAAA,MACIC,YADJ,GACqBH,KADrB,CACIG,YADJ;AAG/B,MAAIC,QAAQ,GAAG,IAAf;;AAEA,MAAID,YAAJ,EAAkB;AACdjB,IAAAA,UAAU,CAACmB,MAAX,CAAkBf,MAAlB,EAA0Ba,YAAY,CAACG,SAAvC;AACA,QAAMX,IAAI,GAAGN,OAAO,CAACC,MAAD,CAApB;;AAFc,eAGOiB,KAAK,CAACC,OAAN,CAAcb,IAAd,IAAsB,CAACA,IAAI,CAAC,CAAD,CAAL,EAAUA,IAAI,CAAC,CAAD,CAAd,CAAtB,GAA2C,CAAC,IAAD,EAAO,IAAP,CAHlD;AAAA;AAAA,QAGPc,IAHO;AAAA,QAGDC,IAHC;;AAId,QAAIC,YAAY,GAAG,EAAnB;;AAEA,QAAIF,IAAJ,EAAU;AACNN,MAAAA,YAAY,CAACG,SAAb,GAAyB;AACrBM,QAAAA,MAAM,EAAE3B,MAAM,CAAC4B,KAAP,CAAavB,MAAb,EAAqBoB,IAArB,CADa;AAErBI,QAAAA,KAAK,EAAE7B,MAAM,CAAC8B,GAAP,CAAWzB,MAAX,EAAmBoB,IAAnB;AAFc,OAAzB;AAIH;;AAED,QAAID,IAAJ,EAAU;AACNE,MAAAA,YAAY,GAAGF,IAAI,CAACX,QAAL,CAAc,CAAd,EAAiBkB,IAAhC;AACH,KAFD,MAEO;AAAA,iDACgBb,YAAY,CAACc,QAD7B;AAAA,UACIA,QADJ;;AAEHN,MAAAA,YAAY,GAAGM,QAAQ,GAAGA,QAAQ,CAACnB,QAAT,CAAkB,CAAlB,EAAqBkB,IAAxB,GAA+B,EAAtD;AACH;;AAEDZ,IAAAA,QAAQ,mCAAQK,IAAR;AAAcO,MAAAA,IAAI,EAAEL;AAApB,MAAR;AACH;;AAED,MAAMO,UAAU,GAAG9C,UAAU,CACzB4B,KADyB,EAEzB;AAAA,QAAGE,WAAH,SAAGA,WAAH;AAAA,QAAgBC,YAAhB,SAAgBA,YAAhB;AAAA,QAA8Bb,MAA9B,SAA8BA,MAA9B;AAAA,WAA2C,iBAAuB;AAAA,UAApB0B,IAAoB,SAApBA,IAAoB;AAAA,UAAXnB,IAAW;;AAAA,UACtDS,SADsD,GACxCH,YADwC,CACtDG,SADsD;AAE9DpB,MAAAA,UAAU,CAACmB,MAAX,CAAkBf,MAAlB,EAA0BgB,SAA1B;AACA,UAAMa,WAAW,GAAGb,SAAS,IAAInB,KAAK,CAACgC,WAAN,CAAkBb,SAAlB,CAAjC;AAEA,UAAMc,YAAY,GAAG/B,OAAO,CAACC,MAAD,CAA5B;;AACA,UAAI8B,YAAJ,EAAkB;AACd,YAAMV,KAAI,GAAGtB,WAAW,CAACiC,QAAZ,CAAqB/B,MAArB,EAA6B8B,YAAY,CAAC,CAAD,CAAzC,CAAb;;AACAlC,QAAAA,UAAU,CAACoC,QAAX,CAAoBhC,MAApB,EAA4BM,UAAU,CAACC,IAAD,EAAO,CAAC;AAAEmB,UAAAA,IAAI,EAAJA;AAAF,SAAD,CAAP,CAAtC,EAA0D;AAAEO,UAAAA,EAAE,EAAEb;AAAN,SAA1D;AACAxB,QAAAA,UAAU,CAACsC,UAAX,CAAsBlC,MAAtB,EAA8B0B,IAA9B,EAAoC;AAAEO,UAAAA,EAAE,EAAEb;AAAN,SAApC;AACH,OAJD,MAIO,IAAIS,WAAJ,EAAiB;AACpBjC,QAAAA,UAAU,CAACuC,WAAX,CAAuBnC,MAAvB,EAA+BM,UAAU,CAACC,IAAD,EAAO,CAAC;AAAEmB,UAAAA,IAAI,EAAJA;AAAF,SAAD,CAAP,CAAzC;AACH,OAFM,MAEA;AACH9B,QAAAA,UAAU,CAACwC,SAAX,CAAqBpC,MAArB,EAA6BM,UAAU,CAACC,IAAD,EAAO,EAAP,CAAvC,EAAmD;AAAE8B,UAAAA,KAAK,EAAE,IAAT;AAAeJ,UAAAA,EAAE,EAAEjB;AAAnB,SAAnD;AACApB,QAAAA,UAAU,CAAC0C,QAAX,CAAoBtC,MAApB,EAA4B;AAAEuC,UAAAA,IAAI,EAAE;AAAR,SAA5B;AACH;;AAED3C,MAAAA,UAAU,CAAC4C,QAAX,CAAoBxC,MAApB;AAEAY,MAAAA,WAAW;AACd,KApBD;AAAA,GAFyB,CAA7B,CA5B+B,CAqD/B;;AArD+B,cAsDSE,QAAQ,IAAI,EAtDrB;AAAA,MAsDvBN,QAtDuB,SAsDvBA,QAtDuB;AAAA,MAsDbJ,IAtDa,SAsDbA,IAtDa;AAAA,MAsDJqC,QAtDI;;AAwD/B,sBACI,oBAAC,MAAD;AAAQ,IAAA,IAAI,EAAE9B,IAAd;AAAoB,IAAA,OAAO,EAAEC,WAA7B;AAA0C,IAAA,KAAK,EAAE;AAAE8B,MAAAA,MAAM,EAAE;AAAV;AAAjD,kBACI,oBAAC,IAAD;AAAM,IAAA,IAAI,EAAED,QAAZ;AAAsB,IAAA,QAAQ,EAAEb;AAAhC,KACK;AAAA,QAAGe,IAAH,SAAGA,IAAH;AAAA,QAASC,MAAT,SAASA,MAAT;AAAA,wBACG,oBAAC,QAAD,qBACI,oBAAC,WAAD,oBADJ,eAEI,oBAAC,aAAD,qBACI,oBAAC,IAAD,qBACI,oBAAC,IAAD;AAAM,MAAA,IAAI,EAAE;AAAZ,oBACI,oBAAC,IAAD;AAAM,MAAA,IAAI,EAAE,MAAZ;AAAoB,MAAA,UAAU,EAAElD,UAAU,CAACmD,MAAX,CAAkB,UAAlB;AAAhC,oBACI,oBAAC,KAAD;AAAO,MAAA,KAAK,EAAC;AAAb,MADJ,CADJ,CADJ,eAMI,oBAAC,IAAD;AAAM,MAAA,IAAI,EAAE;AAAZ,oBACI,oBAAC,IAAD;AACI,MAAA,IAAI,EAAE,MADV;AAEI,MAAA,UAAU,EAAEnD,UAAU,CAACmD,MAAX,CAAkB,4BAAlB;AAFhB,oBAII,oBAAC,KAAD;AAAO,MAAA,KAAK,EAAC;AAAb,MAJJ,CADJ,CANJ,eAcI,oBAAC,IAAD;AAAM,MAAA,IAAI,EAAE;AAAZ,oBACI,oBAAC,IAAD;AAAM,MAAA,IAAI,EAAE;AAAZ,oBACI,oBAAC,MAAD;AACI,MAAA,QAAQ,EAAE;AAAA,eAAMD,MAAM,EAAZ;AAAA,OADd;AAEI,MAAA,KAAK,EAAE;AAFX,MADJ,CADJ,CAdJ,eAsBI,oBAAC,IAAD;AAAM,MAAA,IAAI,EAAE;AAAZ,oBACI,oBAAC,IAAD;AAAM,MAAA,IAAI,EAAE;AAAZ,oBACI,oBAAC,MAAD;AACI,MAAA,QAAQ,EAAE;AAAA,eAAMA,MAAM,EAAZ;AAAA,OADd;AAEI,MAAA,KAAK;AAFT,MADJ,CADJ,CAtBJ,CADJ,CAFJ,eAmCI,oBAAC,aAAD,qBACI,oBAAC,YAAD;AAAc,MAAA,OAAO,EAAEhC;AAAvB,gBADJ,eAEI,oBAAC,YAAD;AAAc,MAAA,OAAO,EAAEgC;AAAvB,YAFJ,CAnCJ,CADH;AAAA,GADL,CADJ,CADJ;AAgDH,CAxGM","sourcesContent":["import React, { Fragment } from \"react\";\nimport { useHandler } from \"@webiny/app/hooks/useHandler\";\nimport { Form } from \"@webiny/form\";\nimport { Input } from \"@webiny/ui/Input\";\nimport { Switch } from \"@webiny/ui/Switch\";\nimport { Cell, Grid } from \"@webiny/ui/Grid\";\nimport {\n    Dialog,\n    DialogContent,\n    DialogTitle,\n    DialogCancel,\n    DialogActions,\n    DialogButton\n} from \"@webiny/ui/Dialog\";\nimport { validation } from \"@webiny/validation\";\nimport { Editor, Transforms, Range } from \"slate\";\nimport { ReactEditor } from \"slate-react\";\n\nconst getLink = editor => {\n    const [item] = Editor.nodes(editor, { match: n => n.type === \"link\" });\n    return item;\n};\n\nconst createLink = (data, children) => {\n    return {\n        type: \"link\",\n        ...data,\n        children\n    };\n};\n\nexport const LinkDialog = props => {\n    const { editor, open, closeDialog, activePlugin } = props;\n\n    let linkData = null;\n\n    if (activePlugin) {\n        Transforms.select(editor, activePlugin.selection);\n        const item = getLink(editor);\n        const [link, path] = Array.isArray(item) ? [item[0], item[1]] : [null, null];\n        let selectedText = \"\";\n\n        if (link) {\n            activePlugin.selection = {\n                anchor: Editor.start(editor, path),\n                focus: Editor.end(editor, path)\n            };\n        }\n\n        if (link) {\n            selectedText = link.children[0].text;\n        } else {\n            const [fragment] = activePlugin.fragment;\n            selectedText = fragment ? fragment.children[0].text : \"\";\n        }\n\n        linkData = { ...link, text: selectedText };\n    }\n\n    const updateLink = useHandler(\n        props,\n        ({ closeDialog, activePlugin, editor }) => ({ text, ...data }) => {\n            const { selection } = activePlugin;\n            Transforms.select(editor, selection);\n            const isCollapsed = selection && Range.isCollapsed(selection);\n\n            const existingLink = getLink(editor);\n            if (existingLink) {\n                const path = ReactEditor.findPath(editor, existingLink[0]);\n                Transforms.setNodes(editor, createLink(data, [{ text }]), { at: path });\n                Transforms.insertText(editor, text, { at: path });\n            } else if (isCollapsed) {\n                Transforms.insertNodes(editor, createLink(data, [{ text }]));\n            } else {\n                Transforms.wrapNodes(editor, createLink(data, []), { split: true, at: selection });\n                Transforms.collapse(editor, { edge: \"end\" });\n            }\n\n            Transforms.deselect(editor);\n\n            closeDialog();\n        }\n    );\n\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    const { children, type, ...formData } = linkData || {};\n\n    return (\n        <Dialog open={open} onClose={closeDialog} style={{ zIndex: 11000 }}>\n            <Form data={formData} onSubmit={updateLink}>\n                {({ Bind, submit }) => (\n                    <Fragment>\n                        <DialogTitle>Edit Link</DialogTitle>\n                        <DialogContent>\n                            <Grid>\n                                <Cell span={12}>\n                                    <Bind name={\"text\"} validators={validation.create(\"required\")}>\n                                        <Input label=\"Text to display\" />\n                                    </Bind>\n                                </Cell>\n                                <Cell span={12}>\n                                    <Bind\n                                        name={\"href\"}\n                                        validators={validation.create(\"required,url:allowRelative\")}\n                                    >\n                                        <Input label=\"URL\" />\n                                    </Bind>\n                                </Cell>\n                                <Cell span={6}>\n                                    <Bind name={\"newTab\"}>\n                                        <Switch\n                                            onChange={() => submit()}\n                                            label={\"Open in new window\"}\n                                        />\n                                    </Bind>\n                                </Cell>\n                                <Cell span={6}>\n                                    <Bind name={\"noFollow\"}>\n                                        <Switch\n                                            onChange={() => submit()}\n                                            label={`Add \"rel=nofollow\"`}\n                                        />\n                                    </Bind>\n                                </Cell>\n                            </Grid>\n                        </DialogContent>\n                        <DialogActions>\n                            <DialogCancel onClick={closeDialog}>Cancel</DialogCancel>\n                            <DialogButton onClick={submit}>OK</DialogButton>\n                        </DialogActions>\n                    </Fragment>\n                )}\n            </Form>\n        </Dialog>\n    );\n};\n"],"file":"LinkDialog.js"}