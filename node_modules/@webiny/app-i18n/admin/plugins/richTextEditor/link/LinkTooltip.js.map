{"version":3,"sources":["../../../../../src/admin/plugins/richTextEditor/link/LinkTooltip.tsx"],"names":["React","useCallback","useRef","useEffect","ReactDOM","styled","css","Elevation","useFocused","useSlate","Editor","Transforms","Tooltip","display","flexDirection","position","top","left","zIndex","width","maxWidth","marginLeft","tooltipInner","padding","borderRadius","fontSize","a","cursor","compressLink","href","start","substr","end","join","getSelectionRect","native","window","getSelection","type","height","range","getRangeAt","getBoundingClientRect","Portal","children","createPortal","document","body","LinkTooltip","activatePlugin","editor","focused","menuRef","menu","current","nodes","match","n","inline","link","style","editorRect","parentNode","menuRect","menuRight","diff","right","activateLink","removeLink","unwrapNodes","length"],"mappings":"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","sourcesContent":["import React, { useCallback, useRef, useEffect } from \"react\";\nimport ReactDOM from \"react-dom\";\nimport styled from \"@emotion/styled\";\nimport { css } from \"emotion\";\nimport { Elevation } from \"@webiny/ui/Elevation\";\nimport { useFocused, useSlate } from \"slate-react\";\nimport { Editor, Transforms } from \"slate\";\n\nconst Tooltip = styled(\"span\")({\n    display: \"flex\",\n    flexDirection: \"row\",\n    position: \"fixed\",\n    top: 20,\n    left: 0,\n    zIndex: 100,\n    width: \"auto\",\n    maxWidth: 520,\n    \"> span:not(:first-of-type)\": {\n        marginLeft: 10\n    }\n});\n\nconst tooltipInner = css({\n    padding: \"5px 10px\",\n    borderRadius: 2,\n    fontSize: \"0.8rem\",\n    a: {\n        cursor: \"pointer\"\n    }\n});\n\nconst compressLink = href => {\n    const start = href.substr(0, 24);\n    const end = href.substr(24).substr(-24);\n\n    return [start, \"...\", end].join(\"\");\n};\n\nconst getSelectionRect = () => {\n    const native = window.getSelection();\n    if (native.type === \"None\") {\n        return { top: 0, left: 0, width: 0, height: 0 };\n    }\n\n    const range = native.getRangeAt(0);\n    return range.getBoundingClientRect();\n};\n\nexport const Portal = ({ children }) => {\n    return ReactDOM.createPortal(children, document.body);\n};\n\nexport const LinkTooltip = ({ activatePlugin }) => {\n    const editor = useSlate();\n    const focused = useFocused();\n    const menuRef = useRef(null);\n    const menu = menuRef.current;\n\n    const [inline] = Editor.nodes(editor, {\n        match: n => n.type === \"link\"\n    }) as any[];\n\n    const link = !!inline ? inline[0] : null;\n\n    useEffect(() => {\n        if ((!link && focused) || !focused) {\n            if (menu) {\n                menu.style.display = \"none\";\n            }\n            return;\n        }\n\n        // Calculate position\n        if (menu) {\n            menu.style.display = \"flex\";\n            const editorRect = menu.parentNode.getBoundingClientRect();\n            const menuRect = menu.getBoundingClientRect();\n            const { top, left, height } = getSelectionRect();\n\n            const menuRight = left + menuRect.width;\n            const diff = editorRect.right - menuRight;\n\n            // Position menu\n            const position = { top: top + height, left: diff < 0 ? left + diff - 30 : left };\n\n            menu.style.top = position.top + \"px\";\n            menu.style.left = position.left + \"px\";\n        }\n    });\n\n    const activateLink = useCallback(() => {\n        activatePlugin(\"link\");\n    }, []);\n\n    const removeLink = useCallback(() => {\n        Transforms.unwrapNodes(editor, { match: n => n.type === \"link\" });\n    }, []);\n\n    const href = link ? link.href : \"\";\n\n    return (\n        <Portal>\n            <Tooltip ref={menuRef} style={{ display: \"none\" }}>\n                <Elevation className={tooltipInner} z={1}>\n                    <span>\n                        Link: {/* eslint-disable-next-line react/jsx-no-target-blank */}\n                        <a href={href} target={\"_blank\"}>\n                            {href.length > 50 ? compressLink(href) : href}\n                        </a>\n                    </span>{\" \"}\n                    | <a onMouseDown={activateLink}>Change</a> |{\" \"}\n                    <a onMouseDown={removeLink}>Remove</a>\n                </Elevation>\n            </Tooltip>\n        </Portal>\n    );\n};\n"],"file":"LinkTooltip.js"}