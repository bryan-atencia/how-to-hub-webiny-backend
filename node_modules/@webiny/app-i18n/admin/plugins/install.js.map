{"version":3,"sources":["../../../src/admin/plugins/install.tsx"],"names":["React","useState","useCallback","gql","useApolloClient","i18n","Form","Alert","Grid","Cell","ButtonPrimary","LocaleCodesAutoComplete","CircularProgress","validation","SimpleForm","SimpleFormHeader","SimpleFormFooter","SimpleFormContent","useI18N","t","ns","IS_INSTALLED","INSTALL","I18NInstaller","onInstalled","client","loading","setLoading","error","setError","refetchLocales","onSubmit","form","mutate","mutation","variables","data","res","install","message","code","Bind","submit","create","name","type","title","dependencies","secure","isInstalled","query","render"],"mappings":"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","sourcesContent":["import React, { useState, useCallback } from \"react\";\nimport gql from \"graphql-tag\";\nimport { useApolloClient } from \"react-apollo\";\nimport { i18n } from \"@webiny/app/i18n\";\nimport { Form } from \"@webiny/form\";\nimport { Alert } from \"@webiny/ui/Alert\";\nimport { Grid, Cell } from \"@webiny/ui/Grid\";\nimport { ButtonPrimary } from \"@webiny/ui/Button\";\nimport LocaleCodesAutoComplete from \"@webiny/app-i18n/admin/views/I18NLocales/LocaleCodesAutoComplete\";\nimport { CircularProgress } from \"@webiny/ui/Progress\";\nimport { validation } from \"@webiny/validation\";\nimport {\n    SimpleForm,\n    SimpleFormHeader,\n    SimpleFormFooter,\n    SimpleFormContent\n} from \"@webiny/app-admin/components/SimpleForm\";\nimport { useI18N } from \"@webiny/app-i18n/hooks/useI18N\";\n\nconst t = i18n.ns(\"app-i18n/admin/installation\");\n\nconst IS_INSTALLED = gql`\n    {\n        i18n {\n            isInstalled {\n                data\n                error {\n                    code\n                    message\n                }\n            }\n        }\n    }\n`;\n\nconst INSTALL = gql`\n    mutation InstallSecurity($data: I18NInstallInput!) {\n        i18n {\n            install(data: $data) {\n                data\n                error {\n                    code\n                    message\n                }\n            }\n        }\n    }\n`;\n\nconst I18NInstaller = ({ onInstalled }) => {\n    const client = useApolloClient();\n    const [loading, setLoading] = useState(false);\n    const [error, setError] = useState(null);\n    const { refetchLocales } = useI18N();\n\n    const onSubmit = useCallback(async form => {\n        setLoading(true);\n        setError(null);\n        const { data: res } = await client.mutate({ mutation: INSTALL, variables: { data: form } });\n        setLoading(false);\n        const { error } = res.i18n.install;\n        if (error) {\n            setError(error.message);\n            return;\n        }\n\n        refetchLocales();\n        onInstalled();\n    }, []);\n\n    return (\n        <Form onSubmit={onSubmit} data={{ code: \"en-US\" }}>\n            {({ Bind, submit }) => (\n                <SimpleForm>\n                    {loading && <CircularProgress />}\n                    {error && (\n                        <Alert title={\"Something went wrong\"} type={\"danger\"}>\n                            {error}\n                        </Alert>\n                    )}\n                    <SimpleFormHeader title={\"Install I18N\"} />\n                    <SimpleFormContent>\n                        <Grid>\n                            <Cell span={12}>\n                                <Bind name=\"code\" validators={validation.create(\"required\")}>\n                                    <LocaleCodesAutoComplete label={t`Select default locale`} />\n                                </Bind>\n                            </Cell>\n                        </Grid>\n                    </SimpleFormContent>\n                    <SimpleFormFooter>\n                        <ButtonPrimary data-testid=\"install-i18n-button\" onClick={submit}>\n                            Install I18N\n                        </ButtonPrimary>\n                    </SimpleFormFooter>\n                </SimpleForm>\n            )}\n        </Form>\n    );\n};\n\nexport default {\n    name: \"installation-i18n\",\n    type: \"admin-installation\",\n    title: \"I18N app\",\n    dependencies: [\"installation-security\"],\n    secure: true,\n    async isInstalled({ client }) {\n        const { data } = await client.query({ query: IS_INSTALLED });\n        return data.i18n.isInstalled.data;\n    },\n    render({ onInstalled }) {\n        return <I18NInstaller onInstalled={onInstalled} />;\n    }\n};\n"],"file":"install.js"}